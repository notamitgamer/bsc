<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Fix favicon 404 error -->
    <link rel="icon" href="data:,">
    <title>notamitgamer/bsc Repository File Index</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS with Kinetic Terminal Configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
              heading: ['Space Grotesk', 'sans-serif'],
            },
            colors: {
              blue: {
                50: 'rgba(190, 242, 100, 0.05)', 
                100: 'rgba(190, 242, 100, 0.1)',
                200: '#d9f99d',
                300: '#bef264',
                400: '#a3d656',
                500: '#bef264',
                600: '#bef264',
                700: '#84cc16',
                800: '#3f6212',
                900: '#365314',
              },
              slate: {
                50: '#050505',
                100: '#111111',
                200: '#27272a',
                300: '#404040',
                400: '#525252',
                500: '#737373',
                600: '#a1a1aa',
                700: '#d4d4d8',
                800: '#e4e4e7',
                900: '#f5f5f5',
              }
            }
          }
        }
      }
    </script>
    
    <!-- CodeMirror 5 (Professional Editor) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/clike/clike.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

    <!-- LZ-String Compression -->
    <script src="https://cdn.jsdelivr.net/npm/lz-string@1.5.0/libs/lz-string.min.js"></script>

    <style>
      :root {
        --bg-main: #050505;
        --accent: #bef264;
        --border-color: #27272a;
        --text-main: #f5f5f5;
        --text-muted: #737373;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-main);
        color: var(--text-main);
      }
      
      h1, h2, h3, .font-heading { font-family: 'Space Grotesk', sans-serif; }

      /* Noise Texture */
      .bg-noise {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0; opacity: 0.03;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      }

      /* CRT Scanline */
      .crt-scanline {
        position: fixed; top: 0; left: 0; width: 100%; height: 2px;
        background: rgba(190, 242, 100, 0.1); opacity: 0.5;
        pointer-events: none; z-index: 50;
        animation: scanline 8s linear infinite;
      }
      @keyframes scanline { 0% { top: -10vh; } 100% { top: 110vh; } }

      .chevron.rotated {
        transform: rotate(180deg);
      }

      .file-item:hover {
        background-color: rgba(190, 242, 100, 0.05) !important;
        border-color: rgba(190, 242, 100, 0.2) !important;
      }
      .folder-container > div:first-child:hover {
        background-color: #111111 !important;
      }
      
      .text-slate-700 { color: #d4d4d8 !important; }
      .text-slate-600 { color: #a1a1aa !important; }
      .text-slate-500 { color: #737373 !important; }
      
      #code-modal .modal-content-area {
        height: 85vh;
        max-height: 90vh;
        background-color: #0d1117 !important; 
        border: 1px solid #30363d;
      }
      @media (min-width: 640px) {
        #code-modal .modal-content-area {
            height: 90vh;
        }
      }

      #modal-code-container {
        padding: 0;
        margin: 0;
        height: 100%;
        overflow: hidden; /* CodeMirror handles scroll */
        position: relative;
      }
      
      /* CodeMirror Overrides */
      .CodeMirror {
        height: 100% !important;
        font-family: 'JetBrains Mono', monospace;
        font-size: 13px;
        background-color: #0d1117 !important;
        color: #f8f8f2;
      }
      .CodeMirror-gutters {
        background-color: #0d1117 !important;
        border-right: 1px solid rgba(255,255,255,0.1) !important;
      }
      .CodeMirror-linenumber {
        color: #6e7681 !important;
      }
      .CodeMirror-cursor {
        border-left: 2px solid var(--accent) !important;
      }
      .CodeMirror-selected {
        background: rgba(190, 242, 100, 0.2) !important;
      }
      
      /* Scrollbar styling */
      .CodeMirror-scroll::-webkit-scrollbar,
      ::-webkit-scrollbar { width: 10px; height: 10px; }
      .CodeMirror-scroll::-webkit-scrollbar-track,
      ::-webkit-scrollbar-track { background: #050505; }
      .CodeMirror-scroll::-webkit-scrollbar-thumb,
      ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 5px; border: 2px solid #050505; }
      .CodeMirror-scroll::-webkit-scrollbar-thumb:hover,
      ::-webkit-scrollbar-thumb:hover { background: #bef264; }

      #app-content { display: none; }
      
      #back-to-top { transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out; }
      #back-to-top.hidden { opacity: 0; pointer-events: none; transform: translateY(20px); }

      #toast { transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
      #toast.show { transform: translateY(0); opacity: 1; }

      .file-item.nav-selected { background-color: rgba(190, 242, 100, 0.1) !important; border-color: #bef264 !important; }
      .file-item.nav-selected span { color: #bef264 !important; }
      
      #modal-filename { color: #e6edf3; }
      #code-loading { background-color: #0d1117; }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900 h-screen flex flex-col overflow-hidden relative selection:bg-lime-300 selection:text-black">
    
    <div class="bg-noise"></div>
    <div class="crt-scanline"></div>

    <!-- App Wrapper -->
    <div id="app-content" class="flex flex-col h-full overflow-hidden relative z-10">
        <!-- Header -->
        <header
        class="bg-[#050505]/90 backdrop-blur-md border-b border-white/10 px-4 sm:px-6 py-3 sm:py-4 flex flex-col sm:flex-row items-start sm:items-center justify-between shrink-0 shadow-sm z-10 gap-4 sm:gap-0 sticky top-0"
        >
        <!-- Logo Section -->
        <div class="flex items-center gap-3 w-full sm:w-auto justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-lime-300/10 rounded-lg shrink-0 border border-lime-300/20">
                <svg class="w-6 h-6 text-lime-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>
                </svg>
                </div>
                <div class="min-w-0">
                <h1 class="text-lg sm:text-xl font-bold text-white tracking-tight truncate font-heading">notamitgamer/bsc</h1>
                <p class="text-xs text-neutral-500 font-medium mt-0.5 truncate font-mono">Repository File Index</p>
                </div>
            </div>
            
            <div class="flex items-center gap-2 sm:hidden">
                <button onclick="openLicenseModal(false)" class="p-2 text-neutral-400 hover:text-lime-300 bg-neutral-900 rounded-md transition-colors border border-neutral-800" title="View License">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                    </svg>
                </button>
                <a href="https://github.com/notamitgamer/bsc" target="_blank" class="text-neutral-400 hover:text-white">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                </a>
            </div>
        </div>

        <!-- Actions Section -->
        <div class="flex items-center gap-3 w-full sm:w-auto flex-wrap sm:flex-nowrap">
            <button onclick="openLicenseModal(false)" class="hidden sm:flex items-center gap-2 px-3 py-2 text-sm font-medium text-neutral-400 hover:text-lime-300 hover:bg-lime-300/10 rounded-md transition-colors shrink-0 font-mono border border-transparent hover:border-lime-300/20" title="View License">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg>
                <span class="inline">License</span>
            </button>

            <div class="relative group grow sm:grow-0 w-full sm:w-auto">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-neutral-500 group-focus-within:text-lime-300 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </div>
                <input type="text" id="search-input" placeholder="Search code... (/)" class="pl-10 pr-10 sm:pr-4 py-2 bg-[#111] border border-neutral-800 rounded-lg text-sm w-full sm:w-64 focus:ring-1 focus:ring-lime-300/50 focus:border-lime-300/50 focus:bg-[#050505] transition-all outline-none text-neutral-200 placeholder:text-neutral-600 font-mono"/>
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none hidden sm:flex">
                    <span class="text-[10px] text-neutral-600 font-mono border border-neutral-800 rounded px-1.5 py-0.5 bg-[#111]">/</span>
                </div>
            </div>
            
            <a href="https://github.com/notamitgamer/bsc" target="_blank" class="hidden sm:flex bg-neutral-100 hover:bg-lime-300 text-black px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm items-center gap-2 font-mono">
                <span>GitHub</span>
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
            </a>
        </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 flex overflow-hidden relative" id="main-scroll-container">
        <!-- File Explorer -->
        <div class="flex-1 overflow-y-auto p-4 sm:p-6 h-full" id="file-explorer-scroll">
            <div class="max-w-4xl mx-auto space-y-4">
                <div id="recent-files-container" class="hidden mb-6">
                    <div class="flex items-center justify-between mb-3 px-1">
                        <h2 class="text-xs font-bold text-neutral-500 uppercase tracking-wider font-mono">Recent Files</h2>
                        <button onclick="confirmClearRecent()" class="text-xs text-red-400 hover:text-red-500 font-medium transition-colors hover:underline font-mono">Clear</button>
                    </div>
                    <div id="recent-files-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2"></div>
                    <hr class="mt-4 border-white/10">
                </div>

                <div class="sticky top-0 z-20 bg-[#050505] py-2 flex justify-end gap-2 border-b border-white/10 backdrop-blur-sm bg-opacity-90 mb-2">
                    <button id="btn-expand" onclick="expandAll()" class="text-xs font-bold text-neutral-500 px-3 py-1.5 rounded-md cursor-not-allowed bg-neutral-900 border border-transparent font-mono" disabled>Expand All</button>
                    <span class="text-neutral-700">|</span>
                    <button id="btn-collapse" onclick="collapseAll()" class="text-xs font-bold text-neutral-500 px-3 py-1.5 rounded-md cursor-not-allowed bg-neutral-900 border border-transparent font-mono" disabled>Collapse All</button>
                </div>

                <div id="file-list-container">
                <!--FILE_LIST_PLACEHOLDER-->
                </div>
            </div>
        </div>
        
        <button id="back-to-top" onclick="scrollToTop()" class="hidden absolute bottom-6 right-6 p-3 bg-neutral-900 border border-neutral-700 text-lime-300 rounded-full shadow-lg hover:bg-lime-300 hover:text-black transition-all z-30">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path></svg>
        </button>
        </main>
    </div>

    <!-- Code Viewer Modal -->
    <div id="code-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50 p-2 sm:p-6 opacity-0 transition-opacity duration-200">
      <div class="bg-[#0d1117] w-full max-w-6xl rounded-xl shadow-2xl flex flex-col border border-white/10 transform scale-95 transition-transform duration-200 modal-content-area">
        <!-- Modal Header -->
        <div class="flex items-center justify-between px-3 sm:px-4 py-3 border-b border-white/10 bg-[#161b22] rounded-t-xl shrink-0 gap-2">
          <div class="flex items-center gap-3 overflow-hidden">
            <div class="flex gap-1.5 shrink-0 opacity-50">
              <div class="w-3 h-3 rounded-full bg-red-500"></div>
              <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
              <div class="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            <div class="flex flex-col min-w-0">
              <h3 id="modal-filename" class="text-xs sm:text-sm font-mono text-lime-300 truncate font-medium">filename.c</h3>
              <span id="modal-filesize" class="text-[10px] text-neutral-500 font-mono"></span>
            </div>
          </div>
          
          <div class="flex items-center gap-1 sm:gap-2 shrink-0 relative">
            
            <!-- Desktop Buttons Group -->
            <div class="hidden sm:flex items-center gap-1 sm:gap-2">
                <button id="new-tab-btn" class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative" title="Open in New Tab">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                </button>

                <!-- Compiler Button -->
                <button onclick="openInCompiler()" class="p-2 text-neutral-400 hover:text-lime-300 hover:bg-lime-300/10 rounded-lg transition-all group relative" title="Open in C Compiler">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>

                <button id="download-btn" class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative" title="Download File">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                </button>

                <button id="print-btn" onclick="printCode()" class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative" title="Print Code">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                </button>

                <button id="share-btn" class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative" title="Copy Link">
                    <svg id="share-icon-default" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>
                    <svg id="share-icon-success" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-lime-300 hidden transform scale-0 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                </button>

                <button id="copy-code-btn" class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative" title="Copy Code">
                    <svg id="copy-icon-default" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    <svg id="copy-icon-success" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-lime-300 hidden transform scale-0 transition-transform duration-200" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                </button>

                <a id="modal-raw-link" href="#" target="_blank" class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors" title="View Raw on GitHub">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                </a>
            </div>

            <!-- Mobile Menu Button -->
            <button id="mobile-menu-btn" class="sm:hidden p-2 text-neutral-400 hover:text-white rounded-lg" onclick="toggleMobileMenu(event)">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z" />
                </svg>
            </button>

            <!-- Mobile Dropdown Menu -->
            <div id="mobile-menu-dropdown" class="hidden absolute top-full right-0 mt-2 w-48 bg-[#161b22] border border-white/10 rounded-xl shadow-xl z-50 overflow-hidden font-mono text-sm">
                <button onclick="openInCompiler()" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-lime-300 flex items-center gap-3 transition-colors border-b border-white/5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    Compile / Run
                </button>
                <button onclick="document.getElementById('new-tab-btn').click()" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-white flex items-center gap-3 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                    New Tab
                </button>
                <button onclick="document.getElementById('download-btn').click()" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-white flex items-center gap-3 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
                    Download
                </button>
                <button onclick="printCode()" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-white flex items-center gap-3 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" /></svg>
                    Print
                </button>
                <button onclick="document.getElementById('share-btn').click()" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-white flex items-center gap-3 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" /></svg>
                    Share Link
                </button>
                <button onclick="document.getElementById('copy-code-btn').click()" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-white flex items-center gap-3 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>
                    Copy Code
                </button>
                <a id="mobile-github-link" href="#" target="_blank" class="w-full text-left px-4 py-3 text-neutral-300 hover:bg-white/10 hover:text-white flex items-center gap-3 transition-colors border-t border-white/5">
                    <svg class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path></svg>
                    View on GitHub
                </a>
            </div>

            <!-- Close Button (Always Visible) -->
            <button onclick="hideCode()" class="p-2 text-neutral-400 hover:text-white hover:bg-red-900/30 hover:text-red-400 rounded-lg transition-colors ml-1" title="Close">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
          </div>
        </div>

        <!-- Code Content -->
        <div class="flex-1 min-h-0 bg-[#0d1117] relative dark-modal-bg">
          <!-- Loading State -->
          <div id="code-loading" class="absolute inset-0 flex items-center justify-center z-10 bg-[#0d1117] hidden">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-lime-300"></div>
          </div>
          <!-- Code Container -->
          <div id="modal-code-container" class="w-full h-full">
             <!-- CodeMirror is injected here -->
          </div>
        </div>
      </div>
    </div>
    
    <!-- License Modal -->
    <div id="license-modal" class="fixed inset-0 bg-black/90 backdrop-blur-md hidden flex items-center justify-center z-[60] p-4 sm:p-6 opacity-0 transition-opacity duration-200">
      <div class="bg-[#111] w-full max-w-3xl rounded-xl shadow-2xl flex flex-col border border-neutral-800 transform scale-95 transition-transform duration-200 max-h-[85vh] sm:max-h-[85vh] max-h-[90vh]">
        <!-- Modal Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-800 shrink-0">
          <h3 class="text-lg font-bold text-white flex items-center gap-2 font-heading">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-lime-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            License Information
          </h3>
          <div class="flex items-center gap-2">
             <a href="https://github.com/notamitgamer/bsc/blob/main/LICENSE" target="_blank" class="p-2 text-neutral-500 hover:text-lime-300 hover:bg-lime-300/10 rounded-lg transition-colors" title="View License on GitHub">
               <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
               </svg>
             </a>
            <button id="license-close-btn" onclick="hideLicense()" class="p-2 text-neutral-500 hover:text-white hover:bg-neutral-800 rounded-lg transition-colors hidden">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
          </div>
        </div>

        <!-- License Content -->
        <div id="license-content" class="p-6 overflow-y-auto font-mono text-sm leading-relaxed text-neutral-400 bg-[#050505]">
            <div class="border-l-4 border-lime-300 pl-4 mb-6">
                <h4 class="font-bold text-white text-lg">MIT LICENSE</h4>
                <p class="text-lime-300/80 font-medium">Open Source Initiative Approved License</p>
                <p class="text-neutral-600 text-xs mt-1">Copyright (c) 2025-2026 AMIT DUTTA</p>
            </div>

            <div class="space-y-4 text-neutral-300">
                <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
                
                <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
                
                <p class="uppercase text-neutral-400 text-xs leading-relaxed border border-neutral-800 p-4 rounded bg-[#111]">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
            </div>
        </div>

        <!-- Modal Footer -->
        <div id="license-footer" class="px-6 py-4 border-t border-neutral-800 bg-[#111] rounded-b-xl flex justify-end shrink-0 gap-3"></div>
      </div>
    </div>
    
    <!-- Confirm Dialog Modal -->
    <div id="confirm-modal" class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-[70] p-4 sm:p-6 opacity-0 transition-opacity duration-200">
      <div class="bg-[#111] w-full max-w-sm rounded-xl shadow-2xl flex flex-col border border-neutral-800 transform scale-95 transition-transform duration-200 p-6">
        <h3 class="text-lg font-bold text-white mb-2 font-heading">Clear Recent Files?</h3>
        <p class="text-sm text-neutral-400 mb-6 font-mono">Are you sure you want to delete your recent file history? This action cannot be undone.</p>
        <div class="flex justify-end gap-3">
            <button onclick="closeConfirmModal()" class="px-4 py-2 bg-neutral-900 hover:bg-neutral-800 text-neutral-300 text-sm font-medium rounded-lg transition-colors border border-neutral-700 font-mono">Cancel</button>
            <button onclick="confirmClearRecentAction()" class="px-4 py-2 bg-red-900/50 hover:bg-red-900 text-red-200 hover:text-white text-sm font-medium rounded-lg transition-colors shadow-sm border border-red-900 font-mono">Delete</button>
        </div>
      </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-neutral-900 text-lime-300 px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-[80] flex items-center gap-2 border border-lime-300/30">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
        <span class="font-mono text-xs uppercase">Link copied to clipboard!</span>
    </div>

    <script>
      function toggleFolder(header) {
        if (header instanceof Event) header = header.currentTarget;
        if (!header || typeof header.querySelector !== 'function') return;

        const content = header.nextElementSibling;
        const icon = header.querySelector(".chevron");
        const folderIcon = header.querySelector(".folder-icon");

        content.classList.toggle("hidden");
        icon.classList.toggle("rotated");

        if (content.classList.contains("hidden")) {
          folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>`;
        } else {
          folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
        }
        updateFolderState();
      }
      
      function updateFolderState() {
          const folders = document.querySelectorAll('.folder-container');
          const total = folders.length;
          let openCount = 0;

          folders.forEach(f => {
              const content = f.children[1];
              if (!content.classList.contains('hidden')) openCount++;
          });

          const btnExpand = document.getElementById('btn-expand');
          const btnCollapse = document.getElementById('btn-collapse');
          
          if (total === 0) {
             setBtnState(btnExpand, false);
             setBtnState(btnCollapse, false);
             return;
          }
          
          if (openCount === 0) {
              setBtnState(btnExpand, true);
              setBtnState(btnCollapse, false);
          } else if (openCount === total) {
              setBtnState(btnExpand, false);
              setBtnState(btnCollapse, true);
          } else {
              setBtnState(btnExpand, true);
              setBtnState(btnCollapse, true);
          }
      }

      function setBtnState(btn, isActive) {
          if (isActive) {
              btn.disabled = false;
              btn.className = "text-xs font-bold text-lime-300 hover:bg-lime-300/10 px-3 py-1.5 rounded-md transition-all duration-200 cursor-pointer border border-lime-300/30 shadow-sm font-mono";
          } else {
              btn.disabled = true;
              btn.className = "text-xs font-bold text-neutral-600 px-3 py-1.5 rounded-md cursor-not-allowed bg-neutral-900 border border-transparent font-mono";
          }
      }

      function expandAll() {
          document.querySelectorAll('.folder-container > div:nth-child(2)').forEach(content => {
              content.classList.remove('hidden');
          });
          document.querySelectorAll('.folder-container .chevron').forEach(icon => {
              icon.classList.add('rotated');
          });
           document.querySelectorAll('.folder-container .folder-icon').forEach(icon => {
              icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
          });
          updateFolderState();
      }

      function collapseAll() {
          document.querySelectorAll('.folder-container > div:nth-child(2)').forEach(content => {
              content.classList.add('hidden');
          });
          document.querySelectorAll('.folder-container .chevron').forEach(icon => {
              icon.classList.remove('rotated');
          });
          document.querySelectorAll('.folder-container .folder-icon').forEach(icon => {
              icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>`;
          });
          updateFolderState();
      }
      
      const MAX_RECENT_FILES = 6;
      let recentFiles = JSON.parse(localStorage.getItem('bsc_recent_files') || '[]');
      
      function checkStorageExpiry() {
          const now = Date.now();
          const setupTime = localStorage.getItem('bsc_setup_time');
          const threeDays = 3 * 24 * 60 * 60 * 1000; 

          if (!setupTime) {
              localStorage.setItem('bsc_setup_time', now);
          } else {
              if (now - parseInt(setupTime) > threeDays) {
                  localStorage.removeItem('license_accepted');
                  localStorage.removeItem('bsc_recent_files');
                  localStorage.setItem('bsc_setup_time', now);
                  recentFiles = []; 
              }
          }
      }
      checkStorageExpiry();

      function updateRecentFilesUI() {
          const container = document.getElementById('recent-files-container');
          const list = document.getElementById('recent-files-list');
          
          if (recentFiles.length === 0) {
              container.classList.add('hidden');
              return;
          }
          
          container.classList.remove('hidden');
          list.innerHTML = '';
          
          recentFiles.forEach(file => {
              const item = document.createElement('div');
              item.className = "flex items-center gap-2 px-3 py-2 bg-[#111] hover:bg-lime-300/10 hover:border-lime-300/30 border border-neutral-800 rounded-lg cursor-pointer transition-all group";
              item.onclick = () => showCode(file.storageId, file.name, file.url);
              item.innerHTML = `
                  <div class="p-1.5 rounded-md bg-lime-300/10 text-lime-300">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <span class="text-xs font-medium text-neutral-400 group-hover:text-white truncate font-mono">${file.name}</span>
              `;
              list.appendChild(item);
          });
      }

      function addToRecent(storageId, name, url) {
          recentFiles = recentFiles.filter(f => f.name !== name);
          recentFiles.unshift({ storageId, name, url });
          if (recentFiles.length > MAX_RECENT_FILES) recentFiles.pop();
          localStorage.setItem('bsc_recent_files', JSON.stringify(recentFiles));
          updateRecentFilesUI();
      }

      const confirmModal = document.getElementById("confirm-modal");
      
      function confirmClearRecent() {
          confirmModal.classList.remove("hidden");
          void confirmModal.offsetWidth;
          confirmModal.classList.remove("opacity-0");
          confirmModal.querySelector("div").classList.remove("scale-95");
      }
      
      function closeConfirmModal() {
          confirmModal.classList.add("opacity-0");
          confirmModal.querySelector("div").classList.add("scale-95");
          setTimeout(() => {
              confirmModal.classList.add("hidden");
          }, 200);
      }
      
      function confirmClearRecentAction() {
          recentFiles = [];
          localStorage.setItem('bsc_recent_files', JSON.stringify(recentFiles));
          updateRecentFilesUI();
          closeConfirmModal();
      }
      
      updateRecentFilesUI();

      const scrollContainer = document.getElementById('file-explorer-scroll');
      const backToTopBtn = document.getElementById('back-to-top');

      scrollContainer.addEventListener('scroll', () => {
          if (scrollContainer.scrollTop > 300) {
              backToTopBtn.classList.remove('hidden');
              setTimeout(() => {
                  backToTopBtn.classList.remove('opacity-0', 'translate-y-4');
              }, 10);
          } else {
              backToTopBtn.classList.add('opacity-0', 'translate-y-4');
              setTimeout(() => {
                  if(scrollContainer.scrollTop <= 300) { 
                      backToTopBtn.classList.add('hidden');
                  }
              }, 300);
          }
      });

      function scrollToTop() {
          scrollContainer.scrollTo({
              top: 0,
              behavior: 'smooth'
          });
      }
      
      function showToast() {
          const toast = document.getElementById("toast");
          toast.classList.remove("hidden");
          void toast.offsetWidth; 
          toast.classList.add("show", "translate-y-0", "opacity-100");
          toast.classList.remove("translate-y-20", "opacity-0");
          
          setTimeout(() => {
              toast.classList.remove("show", "translate-y-0", "opacity-100");
              toast.classList.add("translate-y-20", "opacity-0");
              setTimeout(() => {
                  toast.classList.add("hidden");
              }, 300);
          }, 3000);
      }

      /* --- Code Modal Logic with CodeMirror --- */
      const modal = document.getElementById("code-modal");
      const modalFilename = document.getElementById("modal-filename");
      const modalFileSize = document.getElementById("modal-filesize");
      const modalRawLink = document.getElementById("modal-raw-link");
      const loadingSpinner = document.getElementById("code-loading");
      const newTabBtn = document.getElementById("new-tab-btn");
      const mobileGithubLink = document.getElementById("mobile-github-link");

      let currentFileUrl = "";
      let editor = null;

      function detectMode(filename) {
          if (filename.endsWith('.c')) return 'text/x-csrc';
          if (filename.endsWith('.cpp') || filename.endsWith('.h')) return 'text/x-c++src';
          if (filename.endsWith('.py')) return 'text/x-python';
          if (filename.endsWith('.js')) return 'text/javascript';
          if (filename.endsWith('.html') || filename.endsWith('.xml')) return 'text/html';
          return 'text/plain';
      }

      function showCode(storageId, filename, rawUrl) {
        currentFileUrl = window.location.href.split("?")[0] + "?file=" + encodeURIComponent(filename); 
        modal.classList.remove("hidden");
        void modal.offsetWidth;
        modal.classList.remove("opacity-0");
        modal.querySelector("div").classList.remove("scale-95");

        modalFilename.textContent = filename;
        modalRawLink.href = rawUrl;
        if(mobileGithubLink) mobileGithubLink.href = rawUrl;
        
        addToRecent(storageId, filename, rawUrl);
        
        const storedContent = document.getElementById(storageId);
        let code = "";
        
        if (storedContent) {
             code = storedContent.textContent;
             
             const bytes = new Blob([code]).size;
             const sizeStr = bytes > 1024 ? (bytes/1024).toFixed(2) + " KB" : bytes + " B";
             modalFileSize.textContent = sizeStr;
             
             newTabBtn.onclick = () => {
                 const newWindow = window.open();
                 newWindow.document.write('<html><head><title>' + filename + '</title>');
                 newWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; padding: 20px; background: #0d1117; color: #e6edf3;} </style>');
                 newWindow.document.write('</head><body><pre>' + code.replace(/</g, "&lt;").replace(/>/g, "&gt;") + '</pre></body></html>');
                 newWindow.document.close();
             };

        } else {
            code = "// Error: Content not found";
            modalFileSize.textContent = "";
        }

        const mode = detectMode(filename);

        if (!editor) {
            editor = CodeMirror(document.getElementById("modal-code-container"), {
                value: code,
                mode: mode,
                theme: "dracula",
                lineNumbers: true,
                readOnly: true,
                styleActiveLine: true
            });
        } else {
            editor.setValue(code);
            editor.setOption("mode", mode);
        }
        
        setTimeout(() => editor.refresh(), 10);
          
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('file', filename);
        window.history.pushState({ path: newUrl.href }, '', newUrl.href);
      }

      function hideCode() {
        // Close mobile menu if open
        const dropdown = document.getElementById('mobile-menu-dropdown');
        if (!dropdown.classList.contains('hidden')) {
            dropdown.classList.add('hidden');
        }

        modal.classList.add("opacity-0");
        modal.querySelector("div").classList.add("scale-95");

        setTimeout(() => {
          modal.classList.add("hidden");
          if(editor) editor.setValue("");
        }, 200);
        
        const newUrl = new URL(window.location);
        newUrl.searchParams.delete('file');
        window.history.pushState({ path: newUrl.href }, '', newUrl.href);
      }
      
      const downloadBtn = document.getElementById("download-btn");
      downloadBtn.addEventListener("click", () => {
          const filename = modalFilename.textContent;
          const content = editor ? editor.getValue() : ""; 
          
          const element = document.createElement('a');
          element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
          element.setAttribute('download', filename);

          element.style.display = 'none';
          document.body.appendChild(element);

          element.click();

          document.body.removeChild(element);
      });
      
      function printCode() {
            const content = editor ? editor.getValue() : "";
            const filename = document.getElementById('modal-filename').textContent;
            
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>' + filename + '</title>');
            printWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; padding: 20px;} </style>');
            printWindow.document.write('</head><body>');
            const safeContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            printWindow.document.write('<pre>' + safeContent + '</pre>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
      }

      /* --- NEW COMPILER FEATURE --- */
      function openInCompiler() {
          const codeText = editor ? editor.getValue() : "";
          if (!codeText) return;
          
          // Compress using LZ-String
          const compressed = LZString.compressToEncodedURIComponent(codeText);
          const url = `https://compiler.amit.is-a.dev/c?code=${compressed}`;
          
          window.open(url, '_blank');
      }

      /* --- NEW MOBILE MENU --- */
      function toggleMobileMenu(e) {
          e.stopPropagation();
          const dropdown = document.getElementById('mobile-menu-dropdown');
          dropdown.classList.toggle('hidden');
      }

      // Close mobile menu when clicking outside
      document.addEventListener('click', function(e) {
          const dropdown = document.getElementById('mobile-menu-dropdown');
          const btn = document.getElementById('mobile-menu-btn');
          
          if (!dropdown.classList.contains('hidden') && !btn.contains(e.target) && !dropdown.contains(e.target)) {
              dropdown.classList.add('hidden');
          }
      });

      /* --- License Modal Logic --- */
      const licenseModal = document.getElementById("license-modal");
      const licenseFooter = document.getElementById("license-footer");
      const licenseCloseBtn = document.getElementById("license-close-btn");
      const appContent = document.getElementById("app-content");
      
      function openLicenseModal(forced) {
          licenseModal.classList.remove("hidden");
          void licenseModal.offsetWidth;
          licenseModal.classList.remove("opacity-0");
          licenseModal.querySelector("div").classList.remove("scale-95");
          
          licenseFooter.innerHTML = ""; 
          
          if (forced) {
              licenseCloseBtn.classList.add("hidden");
              
              const btnDecline = document.createElement("button");
              btnDecline.className = "px-4 py-2 bg-neutral-900 hover:bg-red-900/20 text-neutral-400 hover:text-red-400 text-sm font-medium rounded-lg transition-colors border border-neutral-700 font-mono";
              btnDecline.innerText = "Decline";
              btnDecline.onclick = declineLicense;
              
              const btnAccept = document.createElement("button");
              btnAccept.className = "px-4 py-2 bg-lime-300 hover:bg-lime-400 text-black text-sm font-bold rounded-lg transition-colors shadow-sm font-mono";
              btnAccept.innerText = "Accept";
              btnAccept.onclick = acceptLicense;
              
              licenseFooter.appendChild(btnDecline);
              licenseFooter.appendChild(btnAccept);
          } else {
              licenseCloseBtn.classList.remove("hidden");
              
              const btnUnderstand = document.createElement("button");
              btnUnderstand.className = "px-4 py-2 bg-neutral-900 hover:bg-neutral-800 text-white text-sm font-medium rounded-lg transition-colors shadow-sm border border-neutral-700 font-mono";
              btnUnderstand.innerText = "I Understand";
              btnUnderstand.onclick = hideLicense;
              
              licenseFooter.appendChild(btnUnderstand);
          }
      }

      function hideLicense() {
        licenseModal.classList.add("opacity-0");
        licenseModal.querySelector("div").classList.add("scale-95");
        setTimeout(() => {
          licenseModal.classList.add("hidden");
        }, 200);
      }
      
      function acceptLicense() {
          localStorage.setItem("license_accepted", "true");
          hideLicense();
          appContent.style.display = "flex"; 
      }
      
      function declineLicense() {
          document.documentElement.innerHTML = "";
          if (window.history.length > 1) {
              window.history.back();
          } else {
              window.close(); 
          }
      }
      
      function checkLicense() {
          const accepted = localStorage.getItem("license_accepted");
          if (accepted === "true") {
              appContent.style.display = "flex"; 
          } else {
              openLicenseModal(true); 
          }
      }
      
      document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !licenseModal.classList.contains("hidden")) {
              if (!licenseCloseBtn.classList.contains("hidden")) {
                  hideLicense();
              }
          }
      });
      
      licenseModal.addEventListener("click", (e) => {
          if (e.target === licenseModal) {
               if (!licenseCloseBtn.classList.contains("hidden")) {
                  hideLicense();
              }
          }
      });
      
      checkLicense();

      /* --- Search Logic --- */
      let searchIndex = [];

      function buildSearchIndex() {
        searchIndex = [];
        const fileElements = document.querySelectorAll(".file-item");
        fileElements.forEach((el) => {
          const name = el.querySelector("span").textContent.toLowerCase().trim();
          const parentContent = el.closest(".pl-4"); 
          
          const codeDiv = el.querySelector("div[id^='code-']");
          const code = codeDiv ? codeDiv.textContent.toLowerCase() : "";
          
          const storageId = codeDiv ? codeDiv.id : "";

          searchIndex.push({ name, code, element: el, parent: parentContent, storageId });
        });
      }

      const searchInput = document.getElementById("search-input");
      
      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      }

      searchInput.addEventListener("input", (e) => {
        const query = e.target.value.toLowerCase();
        
        document.querySelectorAll('.search-snippet').forEach(el => el.remove());
        document.querySelectorAll('.file-item').forEach(el => {
            el.classList.remove('flex-wrap', 'pb-2');
            el.classList.remove('nav-selected'); 
        });
        
        selectedFileIndex = -1;

        if (searchIndex.length === 0) buildSearchIndex();

        if (!query) {
             document.querySelectorAll('.file-item, .folder-container').forEach(el => el.classList.remove('hidden'));
             updateFolderState(); 
             return;
        }

        document.querySelectorAll('.file-item').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.folder-container').forEach(el => el.classList.add('hidden'));

        searchIndex.forEach(item => {
            const nameMatch = item.name.includes(query);
            const codeMatch = item.code.includes(query);

            if (nameMatch || codeMatch) {
                item.element.classList.remove('hidden');
                
                let parent = item.element.parentElement;
                while(parent && parent.id !== "file-list-container") {
                    parent.classList.remove('hidden'); 
                    if (parent.previousElementSibling) {
                        const folderContainer = parent.parentElement; 
                        if(folderContainer.classList.contains('folder-container')) {
                            folderContainer.classList.remove('hidden');
                        }
                        
                        if(parent.classList.contains('hidden')) {
                           const chevron = parent.previousElementSibling.querySelector('.chevron');
                           if(chevron && !chevron.classList.contains('rotated')) {
                               chevron.classList.add('rotated');
                           }
                           const fIcon = parent.previousElementSibling.querySelector('.folder-icon');
                           if(fIcon) fIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
                        }
                    }
                    parent = parent.parentElement;
                }

                if (codeMatch) {
                    const originalCodeDiv = item.element.querySelector("div[id^='code-']");
                    if (originalCodeDiv) {
                        const originalCode = originalCodeDiv.textContent;
                        const matchIndex = item.code.indexOf(query);
                        
                        if (matchIndex !== -1) {
                            const codePreMatch = item.code.substring(0, matchIndex);
                            const lineCount = (codePreMatch.match(/\n/g) || []).length;
                            
                            const allLines = originalCode.split('\n');
                            const startLine = Math.max(0, lineCount - 2);
                            const endLine = Math.min(allLines.length, lineCount + 3);
                            
                            const snippetLines = allLines.slice(startLine, endLine);
                            
                            const snippetDiv = document.createElement('div');
                            snippetDiv.className = 'search-snippet w-full mt-2 ml-4 sm:ml-7 p-2 bg-[#111] border-l-4 border-lime-300 rounded-r text-xs font-mono text-neutral-400 overflow-x-auto shadow-sm cursor-pointer hover:bg-neutral-900 transition-colors';
                            
                            snippetDiv.onclick = (evt) => {
                                evt.stopPropagation(); 
                                const rawUrl = item.element.querySelector(".flex-1").getAttribute('onclick').match(/'([^']*)'\)$/)[1];
                                showCode(item.storageId, item.element.querySelector("span").textContent, rawUrl);
                            };
                            
                            let htmlContent = '';
                            const safeQuery = escapeRegExp(query);
                            const highlightRegex = new RegExp(`(${safeQuery})`, 'gi');

                            snippetLines.forEach((line, idx) => {
                                const currentLineNum = startLine + idx + 1;
                                let safeLine = line.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#039;");
                                safeLine = safeLine.replace(highlightRegex, '<mark class="bg-lime-300 text-black font-bold rounded-sm px-0.5">$1</mark>');
                                
                                const isMatchLine = (currentLineNum - 1) === lineCount;
                                const lineClass = isMatchLine ? 'bg-lime-300/10 font-semibold' : '';

                                htmlContent += `<div class="whitespace-pre ${lineClass}"><span class="inline-block w-8 text-right mr-3 text-neutral-600 select-none border-r border-neutral-700 pr-1">${currentLineNum}</span>${safeLine}</div>`;
                            });
                            
                            snippetDiv.innerHTML = htmlContent;
                            item.element.classList.add('flex-wrap', 'pb-2');
                            item.element.appendChild(snippetDiv);
                        }
                    }
                }
            }
        });
      });
      
      let selectedFileIndex = -1;

      function handleKeyboardNav(e) {
        if (!modal.classList.contains("hidden")) return;

        const visibleFiles = Array.from(document.querySelectorAll('.file-item:not(.hidden)'));
        if (visibleFiles.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            selectedFileIndex = (selectedFileIndex + 1) % visibleFiles.length;
            updateSelection(visibleFiles);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            selectedFileIndex = (selectedFileIndex - 1 + visibleFiles.length) % visibleFiles.length;
            updateSelection(visibleFiles);
        } else if (e.key === 'Enter' && selectedFileIndex !== -1) {
            e.preventDefault();
            const clickTarget = visibleFiles[selectedFileIndex].querySelector('.flex-1');
            if (clickTarget) clickTarget.click();
        }
      }

      function updateSelection(files) {
        files.forEach(el => el.classList.remove('nav-selected'));
        if (selectedFileIndex >= 0 && selectedFileIndex < files.length) {
            const selectedEl = files[selectedFileIndex];
            selectedEl.classList.add('nav-selected');
            selectedEl.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }

      function animateSuccess(btn, defaultIcon, successIcon) {
        defaultIcon.classList.add("hidden", "scale-0");
        successIcon.classList.remove("hidden", "scale-0");

        setTimeout(() => {
          successIcon.classList.add("hidden", "scale-0");
          defaultIcon.classList.remove("hidden", "scale-0");
        }, 2000);
      }

      document.addEventListener("DOMContentLoaded", () => {
         updateFolderState();

         const params = new URLSearchParams(window.location.search);
         const sharedFile = params.get('file');
         if (sharedFile) {
             const fileElements = document.querySelectorAll(".file-item");
             for (let el of fileElements) {
                 const nameSpan = el.querySelector("span");
                 if (nameSpan && nameSpan.textContent.trim() === sharedFile) {
                     const clickable = el.querySelector(".flex-1");
                     
                     let parentContent = el.closest('.pl-4');
                     while (parentContent) {
                         parentContent.classList.remove('hidden');
                         const folderHeader = parentContent.previousElementSibling;
                         if (folderHeader) {
                             const chevron = folderHeader.querySelector('.chevron');
                             const folderIcon = folderHeader.querySelector('.folder-icon');
                             if (chevron) chevron.classList.add('rotated');
                             if (folderIcon) folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
                         }
                         parentContent = parentContent.parentElement.closest('.pl-4');
                     }

                     if (clickable) {
                         clickable.click();
                         setTimeout(() => {
                             el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                         }, 300);
                     }
                     break;
                 }
             }
         }
      
        const shareBtn = document.getElementById("share-btn");
        const shareIconDefault = document.getElementById("share-icon-default");
        const shareIconSuccess = document.getElementById("share-icon-success");

        shareBtn.addEventListener("click", async () => {
          if (!currentFileUrl) return;

          const shareData = {
            title: modalFilename.textContent,
            text: `Check out this code,\nFile: ${modalFilename.textContent}\nLink: `,
            url: currentFileUrl,
          };

          if (navigator.share) {
            try {
              await navigator.share(shareData);
            } catch (err) {
              if (err.name !== "AbortError") {
                console.error("Share failed:", err.message);
              }
            }
          } else {
            navigator.clipboard.writeText(currentFileUrl).then(() => {
              animateSuccess(shareBtn, shareIconDefault, shareIconSuccess);
              showToast();
            });
          }
        });
        
        const copyCodeBtn = document.getElementById("copy-code-btn");
        const copyIconDefault = document.getElementById("copy-icon-default");
        const copyIconSuccess = document.getElementById("copy-icon-success");

        copyCodeBtn.addEventListener("click", () => {
            const codeText = editor ? editor.getValue() : "";
            navigator.clipboard.writeText(codeText).then(() => {
                animateSuccess(copyCodeBtn, copyIconDefault, copyIconSuccess);
            }).catch(err => {
                console.error('Failed to copy code: ', err);
            });
        });

        document.addEventListener("keydown", (e) => {
          const searchInput = document.getElementById("search-input");
          if (e.key === "Escape" && !modal.classList.contains("hidden")) {
            hideCode();
            return;
          }
          if (
            e.key === "/" &&
            modal.classList.contains("hidden") &&
            !/^(INPUT|TEXTAREA|SELECT)$/i.test(document.activeElement.tagName)
          ) {
            e.preventDefault();
            searchInput.focus();
          }
        });
      });
    </script>
  </body>
</html>