<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Fix favicon 404 error -->
    <link rel="icon" href="data:,">
    <title>notamitgamer/bsc Repository File Index</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Inter:wght@300;400;500&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS with Kinetic Terminal Configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
              mono: ['JetBrains Mono', 'monospace'],
              heading: ['Space Grotesk', 'sans-serif'],
            },
            colors: {
              // Re-mapping 'Blue' (used in generator) to 'Lime' (Portfolio Theme)
              blue: {
                50: 'rgba(190, 242, 100, 0.05)', 
                100: 'rgba(190, 242, 100, 0.1)',
                200: '#d9f99d',
                300: '#bef264',
                400: '#a3d656',
                500: '#bef264', // The Main Lime Accent
                600: '#bef264', // Force standard blue to Lime
                700: '#84cc16',
                800: '#3f6212',
                900: '#365314',
              },
              // Re-mapping 'Slate' (used in generator) to 'Dark/Zinc'
              slate: {
                50: '#050505',  // Main Background
                100: '#111111', // Secondary Background
                200: '#27272a', // Borders
                300: '#404040',
                400: '#525252',
                500: '#737373', // Muted Text
                600: '#a1a1aa', // Primary Text in this context
                700: '#d4d4d8', // Light Text
                800: '#e4e4e7',
                900: '#f5f5f5', // White Text
              }
            }
          }
        }
      }
    </script>
    
    <!-- Theme: GitHub Dark -->
    <link
      id="highlight-theme"
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
      :root {
        --bg-main: #050505;
        --accent: #bef264;
        --border-color: #27272a;
        --text-main: #f5f5f5;
        --text-muted: #737373;
      }

      body {
        font-family: "Inter", sans-serif;
        background-color: var(--bg-main);
        color: var(--text-main);
      }
      
      h1, h2, h3, .font-heading { font-family: 'Space Grotesk', sans-serif; }

      /* --- Visual Effects (From Portfolio) --- */
      
      /* Noise Texture */
      .bg-noise {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        pointer-events: none; z-index: 0; opacity: 0.03;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      }

      /* CRT Scanline */
      .crt-scanline {
        position: fixed; top: 0; left: 0; width: 100%; height: 2px;
        background: rgba(190, 242, 100, 0.1); opacity: 0.5;
        pointer-events: none; z-index: 50;
        animation: scanline 8s linear infinite;
      }
      @keyframes scanline { 0% { top: -10vh; } 100% { top: 110vh; } }

      .chevron.rotated {
        transform: rotate(180deg);
      }

      /* --- UI Overrides for Generated Content --- */
      
      /* Force generated file items to look correct in dark mode 
         Since generated HTML uses 'hover:bg-white', we override it here. */
      .file-item:hover {
        background-color: rgba(190, 242, 100, 0.05) !important;
        border-color: rgba(190, 242, 100, 0.2) !important;
      }
      .folder-container > div:first-child:hover {
        background-color: #111111 !important;
      }
      
      /* Update Text Colors for Generated Content */
      .text-slate-700 { color: #d4d4d8 !important; }
      .text-slate-600 { color: #a1a1aa !important; }
      .text-slate-500 { color: #737373 !important; }
      
      /* --- Modal Styles --- */
      #code-modal .modal-content-area {
        height: 85vh;
        max-height: 90vh;
        background-color: #0d1117 !important; /* GitHub Dark BG */
        border: 1px solid #30363d;
      }
      @media (min-width: 640px) {
        #code-modal .modal-content-area {
            height: 90vh;
        }
      }

      #modal-code-container {
        padding: 0;
        margin: 0;
        height: 100%;
        overflow: auto;
      }
      
      /* Code Block */
      #modal-code-block {
        min-height: 100%;
        overflow: visible;
        padding: 1rem;
        font-family: "JetBrains Mono", "Fira Code", monospace;
        font-size: 0.8125rem;
        line-height: 1.6;
        background-color: transparent !important;
        display: block;
        color: #e6edf3;
      }

      @media (min-width: 640px) {
        #modal-code-block {
            font-size: 0.875rem;
            padding: 1.5rem;
        }
      }

      /* Dark Scrollbars */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      ::-webkit-scrollbar-track {
        background: #050505;
      }
      ::-webkit-scrollbar-thumb {
        background: #27272a;
        border-radius: 5px;
        border: 2px solid #050505;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #bef264; /* Lime Hover */
      }

      .hljs {
        background: transparent !important;
      }

      /* Initial hidden state for app content */
      #app-content {
          display: none;
      }

      /* Back to Top Button */
      #back-to-top {
          transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
      }
      #back-to-top.hidden {
          opacity: 0;
          pointer-events: none;
          transform: translateY(20px);
      }

      /* Toast Notification */
      #toast {
          transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
      }
      #toast.show {
          transform: translateY(0);
          opacity: 1;
      }

      /* Keyboard Navigation Highlight */
      .file-item.nav-selected {
          background-color: rgba(190, 242, 100, 0.1) !important;
          border-color: #bef264 !important;
      }
      .file-item.nav-selected span {
          color: #bef264 !important;
      }
      
      #modal-filename {
          color: #e6edf3;
      }
      #code-loading {
          background-color: #0d1117;
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900 h-screen flex flex-col overflow-hidden relative selection:bg-lime-300 selection:text-black">
    
    <!-- Effects -->
    <div class="bg-noise"></div>
    <div class="crt-scanline"></div>

    <!-- App Wrapper (Hidden until license accepted) -->
    <div id="app-content" class="flex flex-col h-full overflow-hidden relative z-10">
        <!-- Header -->
        <header
        class="bg-[#050505]/90 backdrop-blur-md border-b border-white/10 px-4 sm:px-6 py-3 sm:py-4 flex flex-col sm:flex-row items-start sm:items-center justify-between shrink-0 shadow-sm z-10 gap-4 sm:gap-0 sticky top-0"
        >
        <!-- Logo Section -->
        <div class="flex items-center gap-3 w-full sm:w-auto justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-lime-300/10 rounded-lg shrink-0 border border-lime-300/20">
                <svg
                    class="w-6 h-6 text-lime-300"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"
                    ></path>
                </svg>
                </div>
                <div class="min-w-0">
                <h1 class="text-lg sm:text-xl font-bold text-white tracking-tight truncate font-heading">
                    notamitgamer/bsc
                </h1>
                <p class="text-xs text-neutral-500 font-medium mt-0.5 truncate font-mono">
                    Repository File Index
                </p>
                </div>
            </div>
            
            <div class="flex items-center gap-2 sm:hidden">
                 <!-- Mobile: License Button (Icon Only) -->
                <button
                onclick="openLicenseModal(false)"
                class="p-2 text-neutral-400 hover:text-lime-300 bg-neutral-900 rounded-md transition-colors border border-neutral-800"
                title="View License"
                >
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
                </svg>
                </button>

                <!-- Mobile: Github Icon -->
                <a href="https://github.com/notamitgamer/bsc" target="_blank" class="text-neutral-400 hover:text-white">
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
                    </svg>
                </a>
            </div>
        </div>

        <!-- Actions Section -->
        <div class="flex items-center gap-3 w-full sm:w-auto flex-wrap sm:flex-nowrap">
            
            <!-- Desktop: License Button (Text + Icon) -->
            <button
            onclick="openLicenseModal(false)"
            class="hidden sm:flex items-center gap-2 px-3 py-2 text-sm font-medium text-neutral-400 hover:text-lime-300 hover:bg-lime-300/10 rounded-md transition-colors shrink-0 font-mono border border-transparent hover:border-lime-300/20"
            title="View License"
            >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
            </svg>
            <span class="inline">License</span>
            </button>

            <!-- Search Bar -->
            <div class="relative group grow sm:grow-0 w-full sm:w-auto">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-neutral-500 group-focus-within:text-lime-300 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search code... (/)"
                    class="pl-10 pr-10 sm:pr-4 py-2 bg-[#111] border border-neutral-800 rounded-lg text-sm w-full sm:w-64 focus:ring-1 focus:ring-lime-300/50 focus:border-lime-300/50 focus:bg-[#050505] transition-all outline-none text-neutral-200 placeholder:text-neutral-600 font-mono"
                />
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none hidden sm:flex">
                    <span class="text-[10px] text-neutral-600 font-mono border border-neutral-800 rounded px-1.5 py-0.5 bg-[#111]">/</span>
                </div>
            </div>
            
            <!-- Desktop Github Button -->
            <a
            href="https://github.com/notamitgamer/bsc"
            target="_blank"
            class="hidden sm:flex bg-neutral-100 hover:bg-lime-300 text-black px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm items-center gap-2 font-mono"
            >
            <span>GitHub</span>
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
            </svg>
            </a>
        </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 flex overflow-hidden relative" id="main-scroll-container">
        <!-- File Explorer (Left Panel) -->
        <div class="flex-1 overflow-y-auto p-4 sm:p-6 h-full" id="file-explorer-scroll">
            <div class="max-w-4xl mx-auto space-y-4">
                
                <!-- Recent Files Section -->
                <div id="recent-files-container" class="hidden mb-6">
                    <div class="flex items-center justify-between mb-3 px-1">
                        <h2 class="text-xs font-bold text-neutral-500 uppercase tracking-wider font-mono">Recent Files</h2>
                        <button onclick="confirmClearRecent()" class="text-xs text-red-400 hover:text-red-500 font-medium transition-colors hover:underline font-mono">Clear</button>
                    </div>
                    <div id="recent-files-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
                        <!-- Recent files injected here -->
                    </div>
                    <hr class="mt-4 border-white/10">
                </div>

                <!-- Global Controls (Sticky) -->
                <div class="sticky top-0 z-20 bg-[#050505] py-2 flex justify-end gap-2 border-b border-white/10 backdrop-blur-sm bg-opacity-90 mb-2">
                    <button id="btn-expand" onclick="expandAll()" class="text-xs font-bold text-neutral-500 px-3 py-1.5 rounded-md cursor-not-allowed bg-neutral-900 border border-transparent font-mono" disabled>Expand All</button>
                    <span class="text-neutral-700">|</span>
                    <button id="btn-collapse" onclick="collapseAll()" class="text-xs font-bold text-neutral-500 px-3 py-1.5 rounded-md cursor-not-allowed bg-neutral-900 border border-transparent font-mono" disabled>Collapse All</button>
                </div>

                <div id="file-list-container">
                <!-- Python script will inject the file list here -->
                <!--FILE_LIST_PLACEHOLDER-->
                </div>
            </div>
        </div>
        
        <!-- Back to Top Button -->
        <button id="back-to-top" onclick="scrollToTop()" class="hidden absolute bottom-6 right-6 p-3 bg-neutral-900 border border-neutral-700 text-lime-300 rounded-full shadow-lg hover:bg-lime-300 hover:text-black transition-all z-30">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
            </svg>
        </button>

        </main>
    </div>

    <!-- Code Viewer Modal -->
    <div
      id="code-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-50 p-2 sm:p-6 opacity-0 transition-opacity duration-200"
    >
      <div
        class="bg-[#0d1117] w-full max-w-6xl rounded-xl shadow-2xl flex flex-col border border-white/10 transform scale-95 transition-transform duration-200 modal-content-area"
      >
        <!-- Modal Header -->
        <div
          class="flex items-center justify-between px-3 sm:px-4 py-3 border-b border-white/10 bg-[#161b22] rounded-t-xl shrink-0 gap-2"
        >
          <div class="flex items-center gap-3 overflow-hidden">
            <div class="flex gap-1.5 shrink-0 opacity-50">
              <div class="w-3 h-3 rounded-full bg-red-500"></div>
              <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
              <div class="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
            <div class="flex flex-col min-w-0">
              <h3
                id="modal-filename"
                class="text-xs sm:text-sm font-mono text-lime-300 truncate font-medium"
              >
                filename.c
              </h3>
              <!-- File Size Indicator -->
              <span id="modal-filesize" class="text-[10px] text-neutral-500 font-mono"></span>
            </div>
          </div>
          <div class="flex items-center gap-1 sm:gap-2 shrink-0">
            
            <!-- Open in New Tab Button -->
            <button
              id="new-tab-btn"
              class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative"
              title="Open in New Tab"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </button>

            <!-- Download Button -->
            <button
              id="download-btn"
              class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative"
              title="Download File"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
            </button>

            <!-- Print Button -->
            <button
              id="print-btn"
              onclick="printCode()"
              class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative"
              title="Print Code"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
              </svg>
            </button>

            <!-- Share Button -->
            <button
              id="share-btn"
              class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative"
              title="Copy Link"
            >
              <svg
                id="share-icon-default"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
                />
              </svg>
              <svg
                id="share-icon-success"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-lime-300 hidden transform scale-0 transition-transform duration-200"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            </button>

            <!-- Copy Code Button -->
            <button
              id="copy-code-btn"
              class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-all group relative"
              title="Copy Code"
            >
              <svg
                id="copy-icon-default"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                />
              </svg>
              <svg
                id="copy-icon-success"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-lime-300 hidden transform scale-0 transition-transform duration-200"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            </button>

            <!-- View on GitHub Button -->
            <a
              id="modal-raw-link"
              href="#"
              target="_blank"
              class="p-2 text-neutral-400 hover:text-white hover:bg-white/10 rounded-lg transition-colors"
              title="View Raw on GitHub"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </a>
            <button
              onclick="hideCode()"
              class="p-2 text-neutral-400 hover:text-white hover:bg-red-900/30 hover:text-red-400 rounded-lg transition-colors ml-1"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Code Content -->
        <div class="flex-1 min-h-0 bg-[#0d1117] relative dark-modal-bg">
          <!-- Loading State -->
          <div
            id="code-loading"
            class="absolute inset-0 flex items-center justify-center z-10 bg-[#0d1117] hidden"
          >
            <div
              class="animate-spin rounded-full h-8 w-8 border-b-2 border-lime-300"
            ></div>
          </div>
          <!-- Code Container -->
          <div id="modal-code-container" class="custom-scrollbar">
            <!-- Code Block -->
            <pre class="m-0 p-0 flex-grow"><code id="modal-code-block" class="language-c h-full block"></code></pre>
          </div>
        </div>
      </div>
    </div>
    
    <!-- License Modal -->
    <div
      id="license-modal"
      class="fixed inset-0 bg-black/90 backdrop-blur-md hidden flex items-center justify-center z-[60] p-4 sm:p-6 opacity-0 transition-opacity duration-200"
    >
      <div
        class="bg-[#111] w-full max-w-3xl rounded-xl shadow-2xl flex flex-col border border-neutral-800 transform scale-95 transition-transform duration-200 max-h-[85vh] sm:max-h-[85vh] max-h-[90vh]"
      >
        <!-- Modal Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-neutral-800 shrink-0">
          <h3 class="text-lg font-bold text-white flex items-center gap-2 font-heading">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-lime-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            License Information
          </h3>
          <div class="flex items-center gap-2">
             <!-- License Download Button -->
             <a
             href="https://aranag.site/license"
             target="_blank"
             class="p-2 text-neutral-500 hover:text-lime-300 hover:bg-lime-300/10 rounded-lg transition-colors"
             title="Download License PDF"
           >
             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
             </svg>
           </a>
           
            <button
                id="license-close-btn"
                onclick="hideLicense()"
                class="p-2 text-neutral-500 hover:text-white hover:bg-neutral-800 rounded-lg transition-colors hidden"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
          </div>
        </div>

        <!-- License Content -->
        <div id="license-content" class="p-6 overflow-y-auto font-mono text-sm leading-relaxed text-neutral-400 bg-[#050505]">
            <div class="border-l-4 border-lime-300 pl-4 mb-6">
                <h4 class="font-bold text-white text-lg">EDUCATIONAL SOURCE-AVAILABLE LICENSE (ESAL-1.0)</h4>
                <p class="text-lime-300/80 font-medium">Strict Non-Submission & Anti-Plagiarism Clause</p>
                <p class="text-neutral-600 text-xs mt-1">Copyright (c) 2025, AMIT DUTTA. All Rights Reserved.</p>
            </div>

            <div class="space-y-6">
                <div>
                    <h5 class="font-bold text-white mb-2">1. DEFINITIONS</h5>
                    <ul class="list-disc pl-5 space-y-1">
                        <li><strong>"The Software":</strong> Refers to all code, documentation, logic, and assets contained within this repository.</li>
                        <li><strong>"The Author":</strong> Refers to Amit Dutta.</li>
                        <li><strong>"Academic Use":</strong> Refers to the submission of code for grading, credit, or requirement fulfillment at any educational institution (specifically including, but not limited to, West Bengal State University).</li>
                    </ul>
                </div>

                <div>
                    <h5 class="font-bold text-white mb-2">2. TERMS OF ACCESS (BINDING AGREEMENT)</h5>
                    <p>By accessing, downloading, cloning, or forking this repository, you agree to be bound by the terms of this License. If you do not agree to these terms, you are not permitted to use or view the Software and must delete all copies immediately.</p>
                </div>

                <div>
                    <h5 class="font-bold text-white mb-2">3. LIMITED GRANT OF RIGHTS (REFERENCE ONLY)</h5>
                    <p>The Author grants you a revocable, non-exclusive license to:</p>
                    <ul class="list-disc pl-5 mt-1 space-y-1">
                        <li>Read and study the code for personal learning and skill development.</li>
                        <li>Compile and run the code locally for testing and educational analysis.</li>
                        <li>Reference the underlying logic to create your OWN original implementation.</li>
                    </ul>
                </div>

                <div class="bg-red-900/10 border border-red-900/30 rounded p-4">
                    <h5 class="font-bold text-red-500 mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        4. STRICT PROHIBITIONS (THE "ANTI-PLAGIARISM" CLAUSE)
                    </h5>
                    <p class="text-red-400 mb-2">The rights granted in Section 3 are strictly conditional. You are EXPRESSLY PROHIBITED from:</p>
                    <ul class="list-disc pl-5 space-y-1 text-red-400">
                        <li>Copying, pasting, or modifying this Software (in whole or in part) for submission as your own academic work (assignments, labs, projects).</li>
                        <li>Removing this license or the copyright headers from any file to conceal the code's origin.</li>
                        <li>Redistributing this code on other platforms without the Author's written consent.</li>
                    </ul>
                    <p class="font-bold text-red-500 mt-3 text-sm uppercase">ANY VIOLATION OF SECTION 4 CONSTITUTES A BREACH OF COPYRIGHT AND ACADEMIC MISCONDUCT.</p>
                </div>

                <div>
                    <h5 class="font-bold text-white mb-2">5. ENFORCEMENT & REPORTING</h5>
                    <p>The Author reserves the right to employ software forensics (including Git history and commit timestamps) to establish original ownership. The Author reserves the right to forward evidence of unauthorized use and license violation to:</p>
                    <ul class="list-disc pl-5 mt-1 space-y-1">
                        <li>The Department Head / Faculty of the relevant institution.</li>
                        <li>The Examination Controller of the relevant University.</li>
                        <li>GitHub Trust & Safety (for DMCA Takedown and account suspension).</li>
                    </ul>
                </div>

                <div>
                    <h5 class="font-bold text-white mb-2">6. NO WARRANTY</h5>
                    <p class="text-xs uppercase">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. THE AUTHOR BEARS NO LIABILITY FOR ACADEMIC PENALTIES INCURRED BY USERS WHO VIOLATE THEIR INSTITUTION'S ACADEMIC INTEGRITY POLICIES BY USING THIS CODE.</p>
                </div>

                <div>
                    <h5 class="font-bold text-white mb-2">7. GOVERNING LAW</h5>
                    <p>Any legal disputes regarding the ownership or misuse of this code shall be subject to the laws of India and the jurisdiction of West Bengal.</p>
                </div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div id="license-footer" class="px-6 py-4 border-t border-neutral-800 bg-[#111] rounded-b-xl flex justify-end shrink-0 gap-3">
          <!-- Buttons Injected via JS -->
        </div>
      </div>
    </div>
    
    <!-- Confirm Dialog Modal -->
    <div
      id="confirm-modal"
      class="fixed inset-0 bg-black/80 backdrop-blur-sm hidden flex items-center justify-center z-[70] p-4 sm:p-6 opacity-0 transition-opacity duration-200"
    >
      <div class="bg-[#111] w-full max-w-sm rounded-xl shadow-2xl flex flex-col border border-neutral-800 transform scale-95 transition-transform duration-200 p-6">
        <h3 class="text-lg font-bold text-white mb-2 font-heading">Clear Recent Files?</h3>
        <p class="text-sm text-neutral-400 mb-6 font-mono">Are you sure you want to delete your recent file history? This action cannot be undone.</p>
        <div class="flex justify-end gap-3">
            <button onclick="closeConfirmModal()" class="px-4 py-2 bg-neutral-900 hover:bg-neutral-800 text-neutral-300 text-sm font-medium rounded-lg transition-colors border border-neutral-700 font-mono">Cancel</button>
            <button onclick="confirmClearRecentAction()" class="px-4 py-2 bg-red-900/50 hover:bg-red-900 text-red-200 hover:text-white text-sm font-medium rounded-lg transition-colors shadow-sm border border-red-900 font-mono">Delete</button>
        </div>
      </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 bg-neutral-900 text-lime-300 px-4 py-2 rounded-lg shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-[80] flex items-center gap-2 border border-lime-300/30">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        <span class="font-mono text-xs uppercase">Link copied to clipboard!</span>
    </div>

    <script>
      function toggleFolder(header) {
        // Handle both Event objects (from onclick="toggleFolder(event)") 
        // and Element objects (from onclick="toggleFolder(this)")
        if (header instanceof Event) {
            header = header.currentTarget;
        }

        // Sanity Check
        if (!header || typeof header.querySelector !== 'function') {
            console.error("toggleFolder Error: Invalid header argument.", header);
            return;
        }

        const content = header.nextElementSibling;
        const icon = header.querySelector(".chevron");
        const folderIcon = header.querySelector(".folder-icon");

        // Toggle hidden class
        content.classList.toggle("hidden");
        icon.classList.toggle("rotated");

        // Optional: Change folder icon (open/closed)
        if (content.classList.contains("hidden")) {
          // Closed folder
          folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>`;
        } else {
          // Open folder (visual enhancement)
          folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
        }
        
        // Update global controls based on new state
        updateFolderState();
      }
      
      /* --- Expand/Collapse All Logic --- */
      function updateFolderState() {
          const folders = document.querySelectorAll('.folder-container');
          const total = folders.length;
          let openCount = 0;

          folders.forEach(f => {
              // The content div is the second child of the folder container
              const content = f.children[1];
              if (!content.classList.contains('hidden')) {
                  openCount++;
              }
          });

          const btnExpand = document.getElementById('btn-expand');
          const btnCollapse = document.getElementById('btn-collapse');
          
          if (total === 0) {
             setBtnState(btnExpand, false);
             setBtnState(btnCollapse, false);
             return;
          }
          
          if (openCount === 0) {
              // All folders are collapsed
              setBtnState(btnExpand, true);
              setBtnState(btnCollapse, false);
          } else if (openCount === total) {
              // All folders are expanded
              setBtnState(btnExpand, false);
              setBtnState(btnCollapse, true);
          } else {
              // Mixed state
              setBtnState(btnExpand, true);
              setBtnState(btnCollapse, true);
          }
      }

      function setBtnState(btn, isActive) {
          if (isActive) {
              btn.disabled = false;
              // Active Style (Lime)
              btn.className = "text-xs font-bold text-lime-300 hover:bg-lime-300/10 px-3 py-1.5 rounded-md transition-all duration-200 cursor-pointer border border-lime-300/30 shadow-sm font-mono";
          } else {
              btn.disabled = true;
              // Inactive Style (Grey)
              btn.className = "text-xs font-bold text-neutral-600 px-3 py-1.5 rounded-md cursor-not-allowed bg-neutral-900 border border-transparent font-mono";
          }
      }

      function expandAll() {
          document.querySelectorAll('.folder-container > div:nth-child(2)').forEach(content => {
              content.classList.remove('hidden');
          });
          document.querySelectorAll('.folder-container .chevron').forEach(icon => {
              icon.classList.add('rotated');
          });
           document.querySelectorAll('.folder-container .folder-icon').forEach(icon => {
              icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
          });
          updateFolderState();
      }

      function collapseAll() {
          document.querySelectorAll('.folder-container > div:nth-child(2)').forEach(content => {
              content.classList.add('hidden');
          });
          document.querySelectorAll('.folder-container .chevron').forEach(icon => {
              icon.classList.remove('rotated');
          });
          document.querySelectorAll('.folder-container .folder-icon').forEach(icon => {
              icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>`;
          });
          updateFolderState();
      }
      
      /* --- Recent Files Logic --- */
      const MAX_RECENT_FILES = 6;
      let recentFiles = JSON.parse(localStorage.getItem('bsc_recent_files') || '[]');
      
      // Auto-reset check
      function checkStorageExpiry() {
          const now = Date.now();
          const setupTime = localStorage.getItem('bsc_setup_time');
          // 3 days for standard reset
          const threeDays = 3 * 24 * 60 * 60 * 1000; 

          if (!setupTime) {
              // First run or cleared
              localStorage.setItem('bsc_setup_time', now);
          } else {
              if (now - parseInt(setupTime) > threeDays) {
                  // Expired
                  console.log("Storage expired. Resetting.");
                  localStorage.removeItem('license_accepted');
                  localStorage.removeItem('bsc_recent_files');
                  localStorage.setItem('bsc_setup_time', now); // Reset timer
                  
                  // Reset memory variables if needed
                  recentFiles = []; 
              }
          }
      }
      
      // Call immediately
      checkStorageExpiry();

      function updateRecentFilesUI() {
          const container = document.getElementById('recent-files-container');
          const list = document.getElementById('recent-files-list');
          
          if (recentFiles.length === 0) {
              container.classList.add('hidden');
              return;
          }
          
          container.classList.remove('hidden');
          list.innerHTML = '';
          
          recentFiles.forEach(file => {
              const item = document.createElement('div');
              item.className = "flex items-center gap-2 px-3 py-2 bg-[#111] hover:bg-lime-300/10 hover:border-lime-300/30 border border-neutral-800 rounded-lg cursor-pointer transition-all group";
              item.onclick = () => showCode(file.storageId, file.name, file.url);
              item.innerHTML = `
                  <div class="p-1.5 rounded-md bg-lime-300/10 text-lime-300">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <span class="text-xs font-medium text-neutral-400 group-hover:text-white truncate font-mono">${file.name}</span>
              `;
              list.appendChild(item);
          });
      }

      function addToRecent(storageId, name, url) {
          // Remove if already exists
          recentFiles = recentFiles.filter(f => f.name !== name);
          // Add to top
          recentFiles.unshift({ storageId, name, url });
          // Limit size
          if (recentFiles.length > MAX_RECENT_FILES) recentFiles.pop();
          // Save and Update UI
          localStorage.setItem('bsc_recent_files', JSON.stringify(recentFiles));
          updateRecentFilesUI();
      }

      /* --- Custom Confirm Modal Logic --- */
      const confirmModal = document.getElementById("confirm-modal");
      
      function confirmClearRecent() {
          confirmModal.classList.remove("hidden");
          void confirmModal.offsetWidth;
          confirmModal.classList.remove("opacity-0");
          confirmModal.querySelector("div").classList.remove("scale-95");
      }
      
      function closeConfirmModal() {
          confirmModal.classList.add("opacity-0");
          confirmModal.querySelector("div").classList.add("scale-95");
          setTimeout(() => {
              confirmModal.classList.add("hidden");
          }, 200);
      }
      
      function confirmClearRecentAction() {
          recentFiles = [];
          localStorage.setItem('bsc_recent_files', JSON.stringify(recentFiles));
          updateRecentFilesUI();
          closeConfirmModal();
      }
      
      // Init Recent Files
      updateRecentFilesUI();

      /* --- Scroll to Top Logic --- */
      const scrollContainer = document.getElementById('file-explorer-scroll');
      const backToTopBtn = document.getElementById('back-to-top');

      scrollContainer.addEventListener('scroll', () => {
          if (scrollContainer.scrollTop > 300) {
              backToTopBtn.classList.remove('hidden');
              // Small delay to allow display:block to apply before opacity transition
              setTimeout(() => {
                  backToTopBtn.classList.remove('opacity-0', 'translate-y-4');
              }, 10);
          } else {
              backToTopBtn.classList.add('opacity-0', 'translate-y-4');
              setTimeout(() => {
                  if(scrollContainer.scrollTop <= 300) { // Check again in case user scrolled back up quickly
                      backToTopBtn.classList.add('hidden');
                  }
              }, 300);
          }
      });

      function scrollToTop() {
          scrollContainer.scrollTo({
              top: 0,
              behavior: 'smooth'
          });
      }
      
      /* --- Toast Notification Logic --- */
      function showToast() {
          const toast = document.getElementById("toast");
          toast.classList.remove("hidden");
          // Force reflow
          void toast.offsetWidth; 
          toast.classList.add("show", "translate-y-0", "opacity-100");
          toast.classList.remove("translate-y-20", "opacity-0");
          
          setTimeout(() => {
              toast.classList.remove("show", "translate-y-0", "opacity-100");
              toast.classList.add("translate-y-20", "opacity-0");
              setTimeout(() => {
                  toast.classList.add("hidden");
              }, 300);
          }, 3000);
      }

      /* --- Code Modal Logic --- */
      const modal = document.getElementById("code-modal");
      const modalCodeBlock = document.getElementById("modal-code-block");
      const modalFilename = document.getElementById("modal-filename");
      const modalFileSize = document.getElementById("modal-filesize");
      const modalRawLink = document.getElementById("modal-raw-link");
      const loadingSpinner = document.getElementById("code-loading");
      const newTabBtn = document.getElementById("new-tab-btn");

      let currentFileUrl = "";

      // MODIFIED: Fetch from hidden ID instead of Network URL
      function showCode(storageId, filename, rawUrl) {
        currentFileUrl = window.location.href.split("?")[0] + "?file=" + encodeURIComponent(filename); 
        modal.classList.remove("hidden");
        void modal.offsetWidth;
        modal.classList.remove("opacity-0");
        modal.querySelector("div").classList.remove("scale-95");

        modalFilename.textContent = filename;
        modalRawLink.href = rawUrl;
        
        // Add to recent files
        addToRecent(storageId, filename, rawUrl);
        
        // Reset Share Button State
        const shareIconDefault = document.getElementById("share-icon-default");
        const shareIconSuccess = document.getElementById("share-icon-success");
        shareIconDefault.classList.remove("hidden", "scale-0");
        shareIconSuccess.classList.add("hidden", "scale-0");
        
        // Reset Copy Button State
        const copyIconDefault = document.getElementById("copy-icon-default");
        const copyIconSuccess = document.getElementById("copy-icon-success");
        copyIconDefault.classList.remove("hidden", "scale-0");
        copyIconSuccess.classList.add("hidden", "scale-0");

        // LOAD FROM HIDDEN ELEMENT
        const storedContent = document.getElementById(storageId);
        
        if (storedContent) {
             const code = storedContent.innerHTML;
             modalCodeBlock.innerHTML = code;
             delete modalCodeBlock.dataset.highlighted; 
             hljs.highlightElement(modalCodeBlock);
             
             // Estimate Size (Characters)
             const bytes = new Blob([storedContent.textContent]).size;
             const sizeStr = bytes > 1024 ? (bytes/1024).toFixed(2) + " KB" : bytes + " B";
             modalFileSize.textContent = sizeStr;
             
             // Setup New Tab Button
             newTabBtn.onclick = () => {
                 const newWindow = window.open();
                 newWindow.document.write('<html><head><title>' + filename + '</title>');
                 newWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; padding: 20px; background: #0d1117; color: #e6edf3;} </style>');
                 newWindow.document.write('</head><body><pre>' + storedContent.textContent.replace(/</g, "&lt;").replace(/>/g, "&gt;") + '</pre></body></html>');
                 newWindow.document.close();
             };

        } else {
            modalCodeBlock.textContent = "Error: Code content not found in page.";
            modalFileSize.textContent = "";
        }
          
        // Update URL history
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('file', filename);
        window.history.pushState({ path: newUrl.href }, '', newUrl.href);
      }

      function hideCode() {
        modal.classList.add("opacity-0");
        modal.querySelector("div").classList.add("scale-95");

        setTimeout(() => {
          modal.classList.add("hidden");
          modalCodeBlock.textContent = "";
        }, 200);
        
        const newUrl = new URL(window.location);
        newUrl.searchParams.delete('file');
        window.history.pushState({ path: newUrl.href }, '', newUrl.href);
      }
      
      /* --- Download Logic --- */
      const downloadBtn = document.getElementById("download-btn");
      downloadBtn.addEventListener("click", () => {
          const filename = modalFilename.textContent;
          const content = modalCodeBlock.textContent; // Get plain text
          
          const element = document.createElement('a');
          element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
          element.setAttribute('download', filename);

          element.style.display = 'none';
          document.body.appendChild(element);

          element.click();

          document.body.removeChild(element);
      });
      
      /* --- Print Logic --- */
      function printCode() {
            const content = document.getElementById('modal-code-block').innerText;
            const filename = document.getElementById('modal-filename').textContent;
            
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>' + filename + '</title>');
            printWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; padding: 20px;} </style>');
            printWindow.document.write('</head><body>');
            // Basic HTML escaping for print view
            const safeContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            printWindow.document.write('<pre>' + safeContent + '</pre>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
      }

      /* --- License Modal Logic (UPDATED) --- */
      const licenseModal = document.getElementById("license-modal");
      const licenseFooter = document.getElementById("license-footer");
      const licenseCloseBtn = document.getElementById("license-close-btn");
      const appContent = document.getElementById("app-content");
      
      // Function to open license modal in specific mode
      // forced = true (First Visit), forced = false (View Only)
      function openLicenseModal(forced) {
          licenseModal.classList.remove("hidden");
          void licenseModal.offsetWidth;
          licenseModal.classList.remove("opacity-0");
          licenseModal.querySelector("div").classList.remove("scale-95");
          
          licenseFooter.innerHTML = ""; // Clear existing buttons
          
          if (forced) {
              // Forced Mode: Accept / Decline, No Close Button
              licenseCloseBtn.classList.add("hidden");
              
              const btnDecline = document.createElement("button");
              btnDecline.className = "px-4 py-2 bg-neutral-900 hover:bg-red-900/20 text-neutral-400 hover:text-red-400 text-sm font-medium rounded-lg transition-colors border border-neutral-700 font-mono";
              btnDecline.innerText = "Decline";
              btnDecline.onclick = declineLicense;
              
              const btnAccept = document.createElement("button");
              btnAccept.className = "px-4 py-2 bg-lime-300 hover:bg-lime-400 text-black text-sm font-bold rounded-lg transition-colors shadow-sm font-mono";
              btnAccept.innerText = "Accept";
              btnAccept.onclick = acceptLicense;
              
              licenseFooter.appendChild(btnDecline);
              licenseFooter.appendChild(btnAccept);
          } else {
              // View Mode: I Understand, Close Button visible
              licenseCloseBtn.classList.remove("hidden");
              
              const btnUnderstand = document.createElement("button");
              btnUnderstand.className = "px-4 py-2 bg-neutral-900 hover:bg-neutral-800 text-white text-sm font-medium rounded-lg transition-colors shadow-sm border border-neutral-700 font-mono";
              btnUnderstand.innerText = "I Understand";
              btnUnderstand.onclick = hideLicense;
              
              licenseFooter.appendChild(btnUnderstand);
          }
      }

      function hideLicense() {
        licenseModal.classList.add("opacity-0");
        licenseModal.querySelector("div").classList.add("scale-95");
        setTimeout(() => {
          licenseModal.classList.add("hidden");
        }, 200);
      }
      
      function acceptLicense() {
          localStorage.setItem("license_accepted", "true");
          hideLicense();
          appContent.style.display = "flex"; // Show App
      }
      
      function declineLicense() {
          // Wipe DOM and Go Back
          document.documentElement.innerHTML = "";
          if (window.history.length > 1) {
              window.history.back();
          } else {
              window.close(); // Only works if opened by script
          }
      }
      
      // Initialize License Check
      function checkLicense() {
          const accepted = localStorage.getItem("license_accepted");
          if (accepted === "true") {
              appContent.style.display = "flex"; // Show content immediately
          } else {
              openLicenseModal(true); // Show forced modal
          }
      }
      
      // Event Listeners for Modal Closing (Only if NOT forced)
      document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !licenseModal.classList.contains("hidden")) {
              // Only close if header close button is visible (implies not forced)
              if (!licenseCloseBtn.classList.contains("hidden")) {
                  hideLicense();
              }
          }
      });
      
      licenseModal.addEventListener("click", (e) => {
          if (e.target === licenseModal) {
               // Only close if header close button is visible (implies not forced)
               if (!licenseCloseBtn.classList.contains("hidden")) {
                  hideLicense();
              }
          }
      });
      
      // Trigger license check on load
      checkLicense();

      /* --- Search Logic --- */
      let searchIndex = [];

      function buildSearchIndex() {
        searchIndex = [];
        const fileElements = document.querySelectorAll(".file-item");
        fileElements.forEach((el) => {
          const name = el.querySelector("span").textContent.toLowerCase().trim();
          const parentContent = el.closest(".pl-4"); 
          
          // Get the code content from the hidden div
          const codeDiv = el.querySelector("div[id^='code-']");
          const code = codeDiv ? codeDiv.textContent.toLowerCase() : "";
          
          // Store storageID for click simulation
          const storageId = codeDiv ? codeDiv.id : "";

          searchIndex.push({ name, code, element: el, parent: parentContent, storageId });
        });
      }

      const searchInput = document.getElementById("search-input");
      
      // Helper to escape regex special characters
      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      }

      searchInput.addEventListener("input", (e) => {
        const query = e.target.value.toLowerCase();
        
        // 1. Cleanup: Remove existing snippets and reset layout classes
        document.querySelectorAll('.search-snippet').forEach(el => el.remove());
        document.querySelectorAll('.file-item').forEach(el => {
            el.classList.remove('flex-wrap', 'pb-2');
            el.classList.remove('nav-selected'); // Remove selection style
            // Ensure default styling is maintained
        });
        
        // Reset selection index on search
        selectedFileIndex = -1;

        if (searchIndex.length === 0) buildSearchIndex();

        if (!query) {
             document.querySelectorAll('.file-item, .folder-container').forEach(el => el.classList.remove('hidden'));
             updateFolderState(); // Reset folder state check on clear
             return;
        }

        // Hide all initially
        document.querySelectorAll('.file-item').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.folder-container').forEach(el => el.classList.add('hidden'));

        searchIndex.forEach(item => {
            const nameMatch = item.name.includes(query);
            const codeMatch = item.code.includes(query);

            if (nameMatch || codeMatch) {
                item.element.classList.remove('hidden');
                
                // Parent Folder Logic
                let parent = item.element.parentElement;
                while(parent && parent.id !== "file-list-container") {
                    parent.classList.remove('hidden'); 
                    if (parent.previousElementSibling) {
                        const folderContainer = parent.parentElement; 
                        if(folderContainer.classList.contains('folder-container')) {
                            folderContainer.classList.remove('hidden');
                        }
                        
                        if(parent.classList.contains('hidden')) {
                           const chevron = parent.previousElementSibling.querySelector('.chevron');
                           if(chevron && !chevron.classList.contains('rotated')) {
                               chevron.classList.add('rotated');
                           }
                           const fIcon = parent.previousElementSibling.querySelector('.folder-icon');
                           if(fIcon) fIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
                        }
                    }
                    parent = parent.parentElement;
                }

                // Snippet Logic
                if (codeMatch) {
                    const originalCodeDiv = item.element.querySelector("div[id^='code-']");
                    if (originalCodeDiv) {
                        const originalCode = originalCodeDiv.textContent;
                        
                        // We find the first occurrence index
                        const matchIndex = item.code.indexOf(query);
                        
                        if (matchIndex !== -1) {
                            // Determine line number
                            const codePreMatch = item.code.substring(0, matchIndex);
                            const lineCount = (codePreMatch.match(/\n/g) || []).length;
                            
                            // Extract lines
                            const allLines = originalCode.split('\n');
                            const startLine = Math.max(0, lineCount - 2);
                            const endLine = Math.min(allLines.length, lineCount + 3);
                            
                            const snippetLines = allLines.slice(startLine, endLine);
                            
                            // Create Snippet Element
                            const snippetDiv = document.createElement('div');
                            // w-full ensures it breaks to new line in flex-wrap container
                            snippetDiv.className = 'search-snippet w-full mt-2 ml-4 sm:ml-7 p-2 bg-[#111] border-l-4 border-lime-300 rounded-r text-xs font-mono text-neutral-400 overflow-x-auto shadow-sm cursor-pointer hover:bg-neutral-900 transition-colors';
                            
                            // Click event to open file from snippet
                            snippetDiv.onclick = (evt) => {
                                evt.stopPropagation(); // Prevent double firing if parent has click
                                // Extract raw URL from the parent's onClick attribute
                                const rawUrl = item.element.querySelector(".flex-1").getAttribute('onclick').match(/'([^']*)'\)$/)[1];
                                showCode(item.storageId, item.element.querySelector("span").textContent, rawUrl);
                            };
                            
                            let htmlContent = '';
                            const safeQuery = escapeRegExp(query);
                            const highlightRegex = new RegExp(`(${safeQuery})`, 'gi');

                            snippetLines.forEach((line, idx) => {
                                const currentLineNum = startLine + idx + 1;
                                
                                // Escape HTML special chars in the code line
                                let safeLine = line.replace(/&/g, "&amp;")
                                                   .replace(/</g, "&lt;")
                                                   .replace(/>/g, "&gt;")
                                                   .replace(/"/g, "&quot;")
                                                   .replace(/'/g, "&#039;");

                                // Highlight matches
                                safeLine = safeLine.replace(highlightRegex, '<mark class="bg-lime-300 text-black font-bold rounded-sm px-0.5">$1</mark>');
                                
                                const isMatchLine = (currentLineNum - 1) === lineCount;
                                const lineClass = isMatchLine ? 'bg-lime-300/10 font-semibold' : '';

                                htmlContent += `<div class="whitespace-pre ${lineClass}"><span class="inline-block w-8 text-right mr-3 text-neutral-600 select-none border-r border-neutral-700 pr-1">${currentLineNum}</span>${safeLine}</div>`;
                            });
                            
                            snippetDiv.innerHTML = htmlContent;

                            // Adjust parent layout to accommodate full-width snippet
                            item.element.classList.add('flex-wrap', 'pb-2');
                            item.element.appendChild(snippetDiv);
                        }
                    }
                }
            }
        });
      });
      
      /* --- Keyboard Navigation Logic --- */
      let selectedFileIndex = -1;

      function handleKeyboardNav(e) {
        // Only if modal is hidden
        if (!modal.classList.contains("hidden")) return;

        const visibleFiles = Array.from(document.querySelectorAll('.file-item:not(.hidden)'));
        if (visibleFiles.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            // Move selection down, loop back to start if at end
            selectedFileIndex = (selectedFileIndex + 1) % visibleFiles.length;
            updateSelection(visibleFiles);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            // Move selection up, loop back to end if at start
            selectedFileIndex = (selectedFileIndex - 1 + visibleFiles.length) % visibleFiles.length;
            updateSelection(visibleFiles);
        } else if (e.key === 'Enter' && selectedFileIndex !== -1) {
            e.preventDefault();
            // Trigger click on the selected file item container (first child usually has the onclick)
            // The structure is .file-item > .flex-1 (this has onclick)
            const clickTarget = visibleFiles[selectedFileIndex].querySelector('.flex-1');
            if (clickTarget) clickTarget.click();
        }
      }

      function updateSelection(files) {
        // Remove 'nav-selected' class from all
        files.forEach(el => el.classList.remove('nav-selected'));
        
        // Add to current
        if (selectedFileIndex >= 0 && selectedFileIndex < files.length) {
            const selectedEl = files[selectedFileIndex];
            selectedEl.classList.add('nav-selected');
            
            // Scroll into view logic
            selectedEl.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }

      /* --- Share Functionality --- */
      function animateSuccess(btn, defaultIcon, successIcon) {
        defaultIcon.classList.add("hidden", "scale-0");
        successIcon.classList.remove("hidden", "scale-0");

        setTimeout(() => {
          successIcon.classList.add("hidden", "scale-0");
          defaultIcon.classList.remove("hidden", "scale-0");
        }, 2000);
      }

      document.addEventListener("DOMContentLoaded", () => {
         // Initial Folder State Check
         updateFolderState();

         const params = new URLSearchParams(window.location.search);
         const sharedFile = params.get('file');
         if (sharedFile) {
             const fileElements = document.querySelectorAll(".file-item");
             for (let el of fileElements) {
                 const nameSpan = el.querySelector("span");
                 // Check if the span exists and its content matches the file name
                 if (nameSpan && nameSpan.textContent.trim() === sharedFile) {
                     // Find the clickable container (it has the onclick attribute)
                     // In our structure it's the direct child .flex-1
                     const clickable = el.querySelector(".flex-1");
                     
                     // 1. Expand parents
                     let parentContent = el.closest('.pl-4');
                     while (parentContent) {
                         parentContent.classList.remove('hidden');
                         // Rotate chevron of the folder header
                         const folderHeader = parentContent.previousElementSibling;
                         if (folderHeader) {
                             const chevron = folderHeader.querySelector('.chevron');
                             const folderIcon = folderHeader.querySelector('.folder-icon');
                             if (chevron) chevron.classList.add('rotated');
                             if (folderIcon) folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
                         }
                         parentContent = parentContent.parentElement.closest('.pl-4');
                     }

                     if (clickable) {
                         clickable.click();
                         setTimeout(() => {
                             el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                         }, 300);
                     }
                     break;
                 }
             }
         }
      
        const shareBtn = document.getElementById("share-btn");
        const shareIconDefault = document.getElementById("share-icon-default");
        const shareIconSuccess = document.getElementById("share-icon-success");

        shareBtn.addEventListener("click", async () => {
          if (!currentFileUrl) return;

          const shareData = {
            title: modalFilename.textContent,
            text: `Check out this code,\nFile: ${modalFilename.textContent}\nLink: `,
            url: currentFileUrl,
          };

          if (navigator.share) {
            try {
              await navigator.share(shareData);
            } catch (err) {
              if (err.name !== "AbortError") {
                console.error("Share failed:", err.message);
              }
            }
          } else {
            navigator.clipboard.writeText(currentFileUrl).then(() => {
              animateSuccess(shareBtn, shareIconDefault, shareIconSuccess);
              showToast();
            });
          }
        });
        
        /* --- Copy Code Functionality --- */
        const copyCodeBtn = document.getElementById("copy-code-btn");
        const copyIconDefault = document.getElementById("copy-icon-default");
        const copyIconSuccess = document.getElementById("copy-icon-success");

        copyCodeBtn.addEventListener("click", () => {
            const codeText = modalCodeBlock.innerText;
            navigator.clipboard.writeText(codeText).then(() => {
                animateSuccess(copyCodeBtn, copyIconDefault, copyIconSuccess);
            }).catch(err => {
                console.error('Failed to copy code: ', err);
            });
        });

        document.addEventListener("keydown", (e) => {
          const searchInput = document.getElementById("search-input");
          if (e.key === "Escape" && !modal.classList.contains("hidden")) {
            hideCode();
            return;
          }
          if (
            e.key === "/" &&
            modal.classList.contains("hidden") &&
            !/^(INPUT|TEXTAREA|SELECT)$/i.test(document.activeElement.tagName)
          ) {
            e.preventDefault();
            searchInput.focus();
          }
        });
      });
    </script>
  </body>
</html>