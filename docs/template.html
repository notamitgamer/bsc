<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Fix favicon 404 error -->
    <link rel="icon" href="data:,">
    <title>notamitgamer/bsc Repository File Index</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Default Theme (Visual Studio Light for High Contrast) -->
    <link
      id="highlight-theme"
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/vs.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .chevron.rotated {
        transform: rotate(180deg);
      }

      /* --- Enhanced Code Viewer Modal Styles --- */
      #code-modal .modal-content-area {
        height: 85vh;
        max-height: 90vh;
      }
      @media (min-width: 640px) {
        #code-modal .modal-content-area {
            height: 90vh;
        }
      }

      #modal-code-container {
        padding: 0;
        margin: 0;
        height: 100%;
        overflow: auto;
      }
      
      /* Code Block */
      #modal-code-block {
        min-height: 100%;
        overflow: visible;
        padding: 1rem;
        font-family: "JetBrains Mono", "Fira Code", monospace;
        font-size: 0.8125rem;
        line-height: 1.6;
        background-color: transparent !important;
        display: block;
        color: #000000; /* Ensure high contrast text */
      }

      @media (min-width: 640px) {
        #modal-code-block {
            font-size: 0.875rem;
            padding: 1.5rem;
        }
      }

      /* Scrollbars */
      #modal-code-container::-webkit-scrollbar,
      .custom-scrollbar::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      #modal-code-container::-webkit-scrollbar-track,
      .custom-scrollbar::-webkit-scrollbar-track {
        background: #f1f5f9;
      }
      #modal-code-container::-webkit-scrollbar-thumb,
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 5px;
        border: 2px solid #f1f5f9;
        background-clip: content-box;
      }
      #modal-code-container::-webkit-scrollbar-thumb:hover,
      .custom-scrollbar::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }

      .hljs {
        background: transparent !important;
      }

      /* License Modal Scrollbar */
      #license-content::-webkit-scrollbar {
        width: 8px;
      }
      #license-content::-webkit-scrollbar-track {
        background: #f1f5f9;
        border-radius: 4px;
      }
      #license-content::-webkit-scrollbar-thumb {
        background: #94a3b8;
        border-radius: 4px;
      }
      #license-content::-webkit-scrollbar-thumb:hover {
        background: #64748b;
      }

      /* Initial hidden state for app content */
      #app-content {
          display: none;
      }

      /* Back to Top Button */
      #back-to-top {
          transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
      }
      #back-to-top.hidden {
          opacity: 0;
          pointer-events: none;
          transform: translateY(20px);
      }

      /* Keyboard Navigation Highlight */
      .file-item.nav-selected {
          background-color: #eff6ff; /* blue-50 */
          border-color: #bfdbfe;     /* blue-200 */
          box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
      }
      .file-item.nav-selected span {
          color: #2563eb;            /* blue-600 */
      }
      
      /* Ensure modal background is white in light mode */
      #code-modal .modal-content-area,
      #code-modal .bg-\[\#0d1117\] {
          background-color: #ffffff;
          border-color: #e2e8f0;
          color: #1e293b;
      }
      #code-modal .bg-\[\#161b22\] {
          background-color: #f8fafc;
          border-color: #e2e8f0;
      }
      #modal-filename {
          color: #334155;
      }
      #code-loading {
          background-color: #ffffff;
      }
    </style>
  </head>
  <body class="bg-slate-50 text-slate-900 h-screen flex flex-col overflow-hidden">
    
    <!-- App Wrapper (Hidden until license accepted) -->
    <div id="app-content" class="flex flex-col h-full overflow-hidden relative">
        <!-- Header -->
        <header
        class="bg-white border-b border-slate-200 px-4 sm:px-6 py-3 sm:py-4 flex flex-col sm:flex-row items-start sm:items-center justify-between shrink-0 shadow-sm z-10 gap-4 sm:gap-0"
        >
        <!-- Logo Section -->
        <div class="flex items-center gap-3 w-full sm:w-auto justify-between">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-blue-50 rounded-lg shrink-0">
                <svg
                    class="w-6 h-6 text-blue-600"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                >
                    <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"
                    ></path>
                </svg>
                </div>
                <div class="min-w-0">
                <h1 class="text-lg sm:text-xl font-bold text-slate-800 tracking-tight truncate">
                    notamitgamer/bsc
                </h1>
                <p class="text-xs text-slate-500 font-medium mt-0.5 truncate">
                    Repository File Index
                </p>
                </div>
            </div>
            <!-- License Button -->
            <button
            onclick="openLicenseModal(false)"
            class="flex items-center gap-2 px-3 py-2 text-sm font-medium text-slate-600 hover:text-blue-600 hover:bg-blue-50 rounded-md transition-colors shrink-0"
            title="View License"
            >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" />
            </svg>
            <span class="inline hidden sm:inline">View License</span>
            </button>
            <!-- Mobile: Github Icon -->
            <a href="https://github.com/notamitgamer/bsc" target="_blank" class="sm:hidden text-slate-600 hover:text-slate-900">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
                </svg>
            </a>
        </div>

        <!-- Actions Section -->
        <div class="flex items-center gap-3 w-full sm:w-auto flex-wrap sm:flex-nowrap">

            <!-- Search Bar -->
            <div class="relative group grow sm:grow-0 w-full sm:w-auto">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-slate-400 group-focus-within:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
                <input
                    type="text"
                    id="search-input"
                    placeholder="Search code... (/)"
                    class="pl-10 pr-10 sm:pr-4 py-2 bg-slate-100 border-none rounded-lg text-sm w-full sm:w-64 focus:ring-2 focus:ring-blue-500/20 focus:bg-white transition-all outline-none text-slate-700 placeholder:text-slate-400 font-medium"
                />
                <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none hidden sm:flex">
                    <span class="text-xs text-slate-400 font-sans border border-slate-200 rounded px-1.5 py-0.5 bg-white">/</span>
                </div>
            </div>
            
            <!-- Desktop Github Button -->
            <a
            href="https://github.com/notamitgamer/bsc"
            target="_blank"
            class="hidden sm:flex bg-slate-900 hover:bg-slate-800 text-white px-4 py-2 rounded-lg text-sm font-medium transition-all shadow-sm items-center gap-2"
            >
            <span>GitHub</span>
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
            </svg>
            </a>
        </div>
        </header>

        <!-- Main Content Area -->
        <main class="flex-1 flex overflow-hidden relative" id="main-scroll-container">
        <!-- File Explorer (Left Panel) -->
        <div class="flex-1 overflow-y-auto custom-scrollbar p-4 sm:p-6 h-full" id="file-explorer-scroll">
            <div class="max-w-4xl mx-auto space-y-4">
                
                <!-- Recent Files Section -->
                <div id="recent-files-container" class="hidden mb-6">
                    <div class="flex items-center justify-between mb-3 px-1">
                        <h2 class="text-xs font-bold text-slate-400 uppercase tracking-wider">Recent Files</h2>
                        <button onclick="confirmClearRecent()" class="text-xs text-red-400 hover:text-red-600 font-medium transition-colors hover:underline">Clear</button>
                    </div>
                    <div id="recent-files-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2">
                        <!-- Recent files injected here -->
                    </div>
                    <hr class="mt-4 border-slate-200">
                </div>

                <!-- Global Controls (Sticky) -->
                <div class="sticky top-0 z-20 bg-slate-50 py-2 flex justify-end gap-2 border-b border-slate-200/50 backdrop-blur-sm bg-opacity-90 mb-2">
                    <button id="btn-expand" onclick="expandAll()" class="text-xs font-bold text-slate-400 px-3 py-1.5 rounded-md cursor-not-allowed bg-slate-50 border border-transparent" disabled>Expand All</button>
                    <span class="text-slate-300">|</span>
                    <button id="btn-collapse" onclick="collapseAll()" class="text-xs font-bold text-slate-400 px-3 py-1.5 rounded-md cursor-not-allowed bg-slate-50 border border-transparent" disabled>Collapse All</button>
                </div>

                <div id="file-list-container">
                <!-- Python script will inject the file list here -->
                <!--FILE_LIST_PLACEHOLDER-->
                </div>
            </div>
        </div>
        
        <!-- Back to Top Button -->
        <button id="back-to-top" onclick="scrollToTop()" class="hidden absolute bottom-6 right-6 p-3 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 transition-all z-30">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
            </svg>
        </button>

        </main>
    </div>

    <!-- Code Viewer Modal -->
    <div
      id="code-modal"
      class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden flex items-center justify-center z-50 p-2 sm:p-6 opacity-0 transition-opacity duration-200"
    >
      <div
        class="bg-[#0d1117] w-full max-w-6xl rounded-xl shadow-2xl flex flex-col border border-slate-700/50 transform scale-95 transition-transform duration-200 modal-content-area"
      >
        <!-- Modal Header -->
        <div
          class="flex items-center justify-between px-3 sm:px-4 py-3 border-b border-slate-700/50 bg-[#161b22] rounded-t-xl shrink-0 gap-2"
        >
          <div class="flex items-center gap-3 overflow-hidden">
            <div class="flex gap-1.5 shrink-0">
              <div class="w-3 h-3 rounded-full bg-red-500/80"></div>
              <div class="w-3 h-3 rounded-full bg-yellow-500/80"></div>
              <div class="w-3 h-3 rounded-full bg-green-500/80"></div>
            </div>
            <div class="flex flex-col min-w-0">
              <h3
                id="modal-filename"
                class="text-xs sm:text-sm font-mono text-slate-200 truncate font-medium"
              >
                filename.c
              </h3>
              <!-- File Size Indicator -->
              <span id="modal-filesize" class="text-[10px] text-slate-500 font-mono"></span>
            </div>
          </div>
          <div class="flex items-center gap-1 sm:gap-2 shrink-0">
            
            <!-- Open in New Tab Button -->
            <button
              id="new-tab-btn"
              class="p-2 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all group relative"
              title="Open in New Tab"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
              </svg>
            </button>

            <!-- Download Button -->
            <button
              id="download-btn"
              class="p-2 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all group relative"
              title="Download File"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
              </svg>
            </button>

            <!-- Print Button -->
            <button
              id="print-btn"
              onclick="printCode()"
              class="p-2 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all group relative"
              title="Print Code"
            >
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
              </svg>
            </button>

            <!-- Share Button -->
            <button
              id="share-btn"
              class="p-2 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all group relative"
              title="Copy Link"
            >
              <svg
                id="share-icon-default"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"
                />
              </svg>
              <svg
                id="share-icon-success"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-green-400 hidden transform scale-0 transition-transform duration-200"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            </button>

            <!-- Copy Code Button -->
            <button
              id="copy-code-btn"
              class="p-2 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-all group relative"
              title="Copy Code"
            >
              <svg
                id="copy-icon-default"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
                />
              </svg>
              <svg
                id="copy-icon-success"
                xmlns="http://www.w3.org/2000/svg"
                class="h-5 w-5 text-green-400 hidden transform scale-0 transition-transform duration-200"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
            </button>

            <!-- View on GitHub Button -->
            <a
              id="modal-raw-link"
              href="#"
              target="_blank"
              class="p-2 text-slate-400 hover:text-white hover:bg-slate-700/50 rounded-lg transition-colors"
              title="View Raw on GitHub"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-2.126 1.029-2.935-.103-.253-.446-1.372.097-2.897 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.525.202 2.644.1 2.897.64.809 1.026 1.841 1.026 2.935 0 3.847-2.337 4.687-4.565 4.935.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </a>
            <button
              onclick="hideCode()"
              class="p-2 text-slate-400 hover:text-white hover:bg-red-500/20 hover:text-red-400 rounded-lg transition-colors ml-1"
            >
              <svg
                class="w-5 h-5"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M6 18L18 6M6 6l12 12"
                ></path>
              </svg>
            </button>
          </div>
        </div>

        <!-- Code Content -->
        <div class="flex-1 min-h-0 bg-[#0d1117] relative dark-modal-bg">
          <!-- Loading State -->
          <div
            id="code-loading"
            class="absolute inset-0 flex items-center justify-center z-10 bg-[#0d1117] hidden"
          >
            <div
              class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"
            ></div>
          </div>
          <!-- Code Container -->
          <div id="modal-code-container" class="custom-scrollbar">
            <!-- Code Block -->
            <pre class="m-0 p-0 flex-grow"><code id="modal-code-block" class="language-c h-full block"></code></pre>
          </div>
        </div>
      </div>
    </div>
    
    <!-- License Modal -->
    <div
      id="license-modal"
      class="fixed inset-0 bg-slate-900/90 backdrop-blur-md hidden flex items-center justify-center z-[60] p-4 sm:p-6 opacity-0 transition-opacity duration-200"
    >
      <div
        class="bg-white w-full max-w-3xl rounded-xl shadow-2xl flex flex-col border border-slate-200 transform scale-95 transition-transform duration-200 max-h-[85vh] sm:max-h-[85vh] max-h-[90vh]"
      >
        <!-- Modal Header -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-slate-100 shrink-0">
          <h3 class="text-lg font-bold text-slate-800 flex items-center gap-2">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            License Information
          </h3>
          <div class="flex items-center gap-2">
             <!-- License Download Button -->
             <a
             href="https://aranag.site/download/License - Educational Source-Available License (ESAL-1.0).pdf"
             target="_blank"
             class="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors"
             title="Download License PDF"
           >
             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
               <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
             </svg>
           </a>
           
            <button
                id="license-close-btn"
                onclick="hideLicense()"
                class="p-2 text-slate-400 hover:text-slate-600 hover:bg-slate-100 rounded-lg transition-colors hidden"
            >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
          </div>
        </div>

        <!-- License Content -->
        <div id="license-content" class="p-6 overflow-y-auto font-mono text-sm leading-relaxed text-slate-700 bg-slate-50">
            <div class="border-l-4 border-blue-500 pl-4 mb-6">
                <h4 class="font-bold text-slate-900 text-lg">EDUCATIONAL SOURCE-AVAILABLE LICENSE (ESAL-1.0)</h4>
                <p class="text-slate-500 font-medium">Strict Non-Submission & Anti-Plagiarism Clause</p>
                <p class="text-slate-500 text-xs mt-1">Copyright (c) 2025, AMIT DUTTA. All Rights Reserved.</p>
            </div>

            <div class="space-y-6">
                <div>
                    <h5 class="font-bold text-slate-900 mb-2">1. DEFINITIONS</h5>
                    <ul class="list-disc pl-5 space-y-1">
                        <li><strong>"The Software":</strong> Refers to all code, documentation, logic, and assets contained within this repository.</li>
                        <li><strong>"The Author":</strong> Refers to Amit Dutta.</li>
                        <li><strong>"Academic Use":</strong> Refers to the submission of code for grading, credit, or requirement fulfillment at any educational institution (specifically including, but not limited to, West Bengal State University).</li>
                    </ul>
                </div>

                <div>
                    <h5 class="font-bold text-slate-900 mb-2">2. TERMS OF ACCESS (BINDING AGREEMENT)</h5>
                    <p>By accessing, downloading, cloning, or forking this repository, you agree to be bound by the terms of this License. If you do not agree to these terms, you are not permitted to use or view the Software and must delete all copies immediately.</p>
                </div>

                <div>
                    <h5 class="font-bold text-slate-900 mb-2">3. LIMITED GRANT OF RIGHTS (REFERENCE ONLY)</h5>
                    <p>The Author grants you a revocable, non-exclusive license to:</p>
                    <ul class="list-disc pl-5 mt-1 space-y-1">
                        <li>Read and study the code for personal learning and skill development.</li>
                        <li>Compile and run the code locally for testing and educational analysis.</li>
                        <li>Reference the underlying logic to create your OWN original implementation.</li>
                    </ul>
                </div>

                <div class="bg-red-50 border border-red-200 rounded p-4">
                    <h5 class="font-bold text-red-700 mb-2 flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                        </svg>
                        4. STRICT PROHIBITIONS (THE "ANTI-PLAGIARISM" CLAUSE)
                    </h5>
                    <p class="text-red-800 mb-2">The rights granted in Section 3 are strictly conditional. You are EXPRESSLY PROHIBITED from:</p>
                    <ul class="list-disc pl-5 space-y-1 text-red-800">
                        <li>Copying, pasting, or modifying this Software (in whole or in part) for submission as your own academic work (assignments, labs, projects).</li>
                        <li>Removing this license or the copyright headers from any file to conceal the code's origin.</li>
                        <li>Redistributing this code on other platforms without the Author's written consent.</li>
                    </ul>
                    <p class="font-bold text-red-700 mt-3 text-sm uppercase">ANY VIOLATION OF SECTION 4 CONSTITUTES A BREACH OF COPYRIGHT AND ACADEMIC MISCONDUCT.</p>
                </div>

                <div>
                    <h5 class="font-bold text-slate-900 mb-2">5. ENFORCEMENT & REPORTING</h5>
                    <p>The Author reserves the right to employ software forensics (including Git history and commit timestamps) to establish original ownership. The Author reserves the right to forward evidence of unauthorized use and license violation to:</p>
                    <ul class="list-disc pl-5 mt-1 space-y-1">
                        <li>The Department Head / Faculty of the relevant institution.</li>
                        <li>The Examination Controller of the relevant University.</li>
                        <li>GitHub Trust & Safety (for DMCA Takedown and account suspension).</li>
                    </ul>
                </div>

                <div>
                    <h5 class="font-bold text-slate-900 mb-2">6. NO WARRANTY</h5>
                    <p class="text-xs uppercase">THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND. THE AUTHOR BEARS NO LIABILITY FOR ACADEMIC PENALTIES INCURRED BY USERS WHO VIOLATE THEIR INSTITUTION'S ACADEMIC INTEGRITY POLICIES BY USING THIS CODE.</p>
                </div>

                <div>
                    <h5 class="font-bold text-slate-900 mb-2">7. GOVERNING LAW</h5>
                    <p>Any legal disputes regarding the ownership or misuse of this code shall be subject to the laws of India and the jurisdiction of West Bengal.</p>
                </div>
            </div>
        </div>

        <!-- Modal Footer -->
        <div id="license-footer" class="px-6 py-4 border-t border-slate-100 bg-slate-50 rounded-b-xl flex justify-end shrink-0 gap-3">
          <!-- Buttons Injected via JS -->
        </div>
      </div>
    </div>
    
    <!-- Confirm Dialog Modal -->
    <div
      id="confirm-modal"
      class="fixed inset-0 bg-slate-900/60 backdrop-blur-sm hidden flex items-center justify-center z-[70] p-4 sm:p-6 opacity-0 transition-opacity duration-200"
    >
      <div class="bg-white w-full max-w-sm rounded-xl shadow-2xl flex flex-col border border-slate-200 transform scale-95 transition-transform duration-200 p-6">
        <h3 class="text-lg font-bold text-slate-800 mb-2">Clear Recent Files?</h3>
        <p class="text-sm text-slate-600 mb-6">Are you sure you want to delete your recent file history? This action cannot be undone.</p>
        <div class="flex justify-end gap-3">
            <button onclick="closeConfirmModal()" class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 text-sm font-medium rounded-lg transition-colors">Cancel</button>
            <button onclick="confirmClearRecentAction()" class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm">Delete</button>
        </div>
      </div>
    </div>

    <script>
      function toggleFolder(header) {
        // Handle both Event objects (from onclick="toggleFolder(event)") 
        // and Element objects (from onclick="toggleFolder(this)")
        if (header instanceof Event) {
            header = header.currentTarget;
        }

        // Sanity Check
        if (!header || typeof header.querySelector !== 'function') {
            console.error("toggleFolder Error: Invalid header argument.", header);
            return;
        }

        const content = header.nextElementSibling;
        const icon = header.querySelector(".chevron");
        const folderIcon = header.querySelector(".folder-icon");

        // Toggle hidden class
        content.classList.toggle("hidden");
        icon.classList.toggle("rotated");

        // Optional: Change folder icon (open/closed)
        if (content.classList.contains("hidden")) {
          // Closed folder
          folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>`;
        } else {
          // Open folder (visual enhancement)
          folderIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
        }
        
        // Update global controls based on new state
        updateFolderState();
      }
      
      /* --- Expand/Collapse All Logic --- */
      function updateFolderState() {
          const folders = document.querySelectorAll('.folder-container');
          const total = folders.length;
          let openCount = 0;

          folders.forEach(f => {
              // The content div is the second child of the folder container
              const content = f.children[1];
              if (!content.classList.contains('hidden')) {
                  openCount++;
              }
          });

          const btnExpand = document.getElementById('btn-expand');
          const btnCollapse = document.getElementById('btn-collapse');
          
          if (total === 0) {
             setBtnState(btnExpand, false);
             setBtnState(btnCollapse, false);
             return;
          }
          
          if (openCount === 0) {
              // All folders are collapsed
              setBtnState(btnExpand, true);
              setBtnState(btnCollapse, false);
          } else if (openCount === total) {
              // All folders are expanded
              setBtnState(btnExpand, false);
              setBtnState(btnCollapse, true);
          } else {
              // Mixed state
              setBtnState(btnExpand, true);
              setBtnState(btnCollapse, true);
          }
      }

      function setBtnState(btn, isActive) {
          if (isActive) {
              btn.disabled = false;
              // Active Style (Blue)
              btn.className = "text-xs font-bold text-blue-600 hover:bg-blue-50 px-3 py-1.5 rounded-md transition-all duration-200 cursor-pointer border border-blue-100 shadow-sm";
          } else {
              btn.disabled = true;
              // Inactive Style (Grey)
              btn.className = "text-xs font-bold text-slate-400 px-3 py-1.5 rounded-md cursor-not-allowed bg-slate-50 border border-transparent";
          }
      }

      function expandAll() {
          document.querySelectorAll('.folder-container > div:nth-child(2)').forEach(content => {
              content.classList.remove('hidden');
          });
          document.querySelectorAll('.folder-container .chevron').forEach(icon => {
              icon.classList.add('rotated');
          });
           document.querySelectorAll('.folder-container .folder-icon').forEach(icon => {
              icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
          });
          updateFolderState();
      }

      function collapseAll() {
          document.querySelectorAll('.folder-container > div:nth-child(2)').forEach(content => {
              content.classList.add('hidden');
          });
          document.querySelectorAll('.folder-container .chevron').forEach(icon => {
              icon.classList.remove('rotated');
          });
          document.querySelectorAll('.folder-container .folder-icon').forEach(icon => {
              icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path>`;
          });
          updateFolderState();
      }
      
      /* --- Recent Files Logic --- */
      const MAX_RECENT_FILES = 6;
      let recentFiles = JSON.parse(localStorage.getItem('bsc_recent_files') || '[]');
      
      // Auto-reset check
      function checkStorageExpiry() {
          const now = Date.now();
          const setupTime = localStorage.getItem('bsc_setup_time');
          // 3 days for standard reset, 72 hours for theme reset (logic combined here for simplicity as requested)
          // The prompt asked for theme to reset at 72 hours. 
          // Since 3 days == 72 hours, we can use one timer for general preferences or separate if strictly needed.
          // Let's use one 'setup_time' for all expiration logic to keep it simple.
          const threeDays = 3 * 24 * 60 * 60 * 1000; 

          if (!setupTime) {
              // First run or cleared
              localStorage.setItem('bsc_setup_time', now);
          } else {
              if (now - parseInt(setupTime) > threeDays) {
                  // Expired
                  console.log("Storage expired. Resetting.");
                  localStorage.removeItem('license_accepted');
                  localStorage.removeItem('bsc_recent_files');
                  localStorage.setItem('bsc_setup_time', now); // Reset timer
                  
                  // Reset memory variables if needed
                  recentFiles = []; 
              }
          }
      }
      
      // Call immediately
      checkStorageExpiry();

      function updateRecentFilesUI() {
          const container = document.getElementById('recent-files-container');
          const list = document.getElementById('recent-files-list');
          
          if (recentFiles.length === 0) {
              container.classList.add('hidden');
              return;
          }
          
          container.classList.remove('hidden');
          list.innerHTML = '';
          
          recentFiles.forEach(file => {
              const item = document.createElement('div');
              item.className = "flex items-center gap-2 px-3 py-2 bg-white hover:bg-blue-50 border border-slate-200 rounded-lg cursor-pointer transition-all group";
              item.onclick = () => showCode(file.storageId, file.name, file.url);
              item.innerHTML = `
                  <div class="p-1.5 rounded-md bg-blue-100/50 text-blue-600">
                    <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                    </svg>
                  </div>
                  <span class="text-xs font-medium text-slate-700 truncate">${file.name}</span>
              `;
              list.appendChild(item);
          });
      }

      function addToRecent(storageId, name, url) {
          // Remove if already exists
          recentFiles = recentFiles.filter(f => f.name !== name);
          // Add to top
          recentFiles.unshift({ storageId, name, url });
          // Limit size
          if (recentFiles.length > MAX_RECENT_FILES) recentFiles.pop();
          // Save and Update UI
          localStorage.setItem('bsc_recent_files', JSON.stringify(recentFiles));
          updateRecentFilesUI();
      }

      /* --- Custom Confirm Modal Logic --- */
      const confirmModal = document.getElementById("confirm-modal");
      
      function confirmClearRecent() {
          confirmModal.classList.remove("hidden");
          void confirmModal.offsetWidth;
          confirmModal.classList.remove("opacity-0");
          confirmModal.querySelector("div").classList.remove("scale-95");
      }
      
      function closeConfirmModal() {
          confirmModal.classList.add("opacity-0");
          confirmModal.querySelector("div").classList.add("scale-95");
          setTimeout(() => {
              confirmModal.classList.add("hidden");
          }, 200);
      }
      
      function confirmClearRecentAction() {
          recentFiles = [];
          localStorage.setItem('bsc_recent_files', JSON.stringify(recentFiles));
          updateRecentFilesUI();
          closeConfirmModal();
      }
      
      // Init Recent Files
      updateRecentFilesUI();

      /* --- Scroll to Top Logic --- */
      const scrollContainer = document.getElementById('file-explorer-scroll');
      const backToTopBtn = document.getElementById('back-to-top');

      scrollContainer.addEventListener('scroll', () => {
          if (scrollContainer.scrollTop > 300) {
              backToTopBtn.classList.remove('hidden');
              // Small delay to allow display:block to apply before opacity transition
              setTimeout(() => {
                  backToTopBtn.classList.remove('opacity-0', 'translate-y-4');
              }, 10);
          } else {
              backToTopBtn.classList.add('opacity-0', 'translate-y-4');
              setTimeout(() => {
                  if(scrollContainer.scrollTop <= 300) { // Check again in case user scrolled back up quickly
                      backToTopBtn.classList.add('hidden');
                  }
              }, 300);
          }
      });

      function scrollToTop() {
          scrollContainer.scrollTo({
              top: 0,
              behavior: 'smooth'
          });
      }

      /* --- Code Modal Logic --- */
      const modal = document.getElementById("code-modal");
      const modalCodeBlock = document.getElementById("modal-code-block");
      const modalFilename = document.getElementById("modal-filename");
      const modalFileSize = document.getElementById("modal-filesize");
      const modalRawLink = document.getElementById("modal-raw-link");
      const loadingSpinner = document.getElementById("code-loading");
      const newTabBtn = document.getElementById("new-tab-btn");

      let currentFileUrl = "";

      // MODIFIED: Fetch from hidden ID instead of Network URL
      function showCode(storageId, filename, rawUrl) {
        currentFileUrl = window.location.href.split("?")[0] + "?file=" + encodeURIComponent(filename); 
        modal.classList.remove("hidden");
        void modal.offsetWidth;
        modal.classList.remove("opacity-0");
        modal.querySelector("div").classList.remove("scale-95");

        modalFilename.textContent = filename;
        modalRawLink.href = rawUrl;
        
        // Add to recent files
        addToRecent(storageId, filename, rawUrl);
        
        // Reset Share Button State
        const shareIconDefault = document.getElementById("share-icon-default");
        const shareIconSuccess = document.getElementById("share-icon-success");
        shareIconDefault.classList.remove("hidden", "scale-0");
        shareIconSuccess.classList.add("hidden", "scale-0");
        
        // Reset Copy Button State
        const copyIconDefault = document.getElementById("copy-icon-default");
        const copyIconSuccess = document.getElementById("copy-icon-success");
        copyIconDefault.classList.remove("hidden", "scale-0");
        copyIconSuccess.classList.add("hidden", "scale-0");

        // LOAD FROM HIDDEN ELEMENT
        const storedContent = document.getElementById(storageId);
        
        if (storedContent) {
             const code = storedContent.innerHTML;
             modalCodeBlock.innerHTML = code;
             delete modalCodeBlock.dataset.highlighted; 
             hljs.highlightElement(modalCodeBlock);
             
             // Estimate Size (Characters)
             const bytes = new Blob([storedContent.textContent]).size;
             const sizeStr = bytes > 1024 ? (bytes/1024).toFixed(2) + " KB" : bytes + " B";
             modalFileSize.textContent = sizeStr;
             
             // Setup New Tab Button
             newTabBtn.onclick = () => {
                 const newWindow = window.open();
                 newWindow.document.write('<html><head><title>' + filename + '</title>');
                 newWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; padding: 20px; background: #f0f0f0;} </style>');
                 newWindow.document.write('</head><body><pre>' + storedContent.textContent.replace(/</g, "&lt;").replace(/>/g, "&gt;") + '</pre></body></html>');
                 newWindow.document.close();
             };

        } else {
            modalCodeBlock.textContent = "Error: Code content not found in page.";
            modalFileSize.textContent = "";
        }
          
        // Update URL history
        const newUrl = new URL(window.location);
        newUrl.searchParams.set('file', filename);
        window.history.pushState({ path: newUrl.href }, '', newUrl.href);
      }

      function hideCode() {
        modal.classList.add("opacity-0");
        modal.querySelector("div").classList.add("scale-95");

        setTimeout(() => {
          modal.classList.add("hidden");
          modalCodeBlock.textContent = "";
        }, 200);
        
        const newUrl = new URL(window.location);
        newUrl.searchParams.delete('file');
        window.history.pushState({ path: newUrl.href }, '', newUrl.href);
      }
      
      /* --- Download Logic --- */
      const downloadBtn = document.getElementById("download-btn");
      downloadBtn.addEventListener("click", () => {
          const filename = modalFilename.textContent;
          const content = modalCodeBlock.textContent; // Get plain text
          
          const element = document.createElement('a');
          element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
          element.setAttribute('download', filename);

          element.style.display = 'none';
          document.body.appendChild(element);

          element.click();

          document.body.removeChild(element);
      });
      
      /* --- Print Logic --- */
      function printCode() {
            const content = document.getElementById('modal-code-block').innerText;
            const filename = document.getElementById('modal-filename').textContent;
            
            const printWindow = window.open('', '', 'height=600,width=800');
            printWindow.document.write('<html><head><title>' + filename + '</title>');
            printWindow.document.write('<style>body{font-family: monospace; white-space: pre-wrap; padding: 20px;} </style>');
            printWindow.document.write('</head><body>');
            // Basic HTML escaping for print view
            const safeContent = content.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            printWindow.document.write('<pre>' + safeContent + '</pre>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.focus();
            printWindow.print();
      }

      /* --- License Modal Logic (UPDATED) --- */
      const licenseModal = document.getElementById("license-modal");
      const licenseFooter = document.getElementById("license-footer");
      const licenseCloseBtn = document.getElementById("license-close-btn");
      const appContent = document.getElementById("app-content");
      
      // Function to open license modal in specific mode
      // forced = true (First Visit), forced = false (View Only)
      function openLicenseModal(forced) {
          licenseModal.classList.remove("hidden");
          void licenseModal.offsetWidth;
          licenseModal.classList.remove("opacity-0");
          licenseModal.querySelector("div").classList.remove("scale-95");
          
          licenseFooter.innerHTML = ""; // Clear existing buttons
          
          if (forced) {
              // Forced Mode: Accept / Decline, No Close Button
              licenseCloseBtn.classList.add("hidden");
              
              const btnDecline = document.createElement("button");
              btnDecline.className = "px-4 py-2 bg-slate-100 hover:bg-red-50 text-slate-600 hover:text-red-600 text-sm font-medium rounded-lg transition-colors border border-slate-200";
              btnDecline.innerText = "Decline";
              btnDecline.onclick = declineLicense;
              
              const btnAccept = document.createElement("button");
              btnAccept.className = "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm";
              btnAccept.innerText = "Accept";
              btnAccept.onclick = acceptLicense;
              
              licenseFooter.appendChild(btnDecline);
              licenseFooter.appendChild(btnAccept);
          } else {
              // View Mode: I Understand, Close Button visible
              licenseCloseBtn.classList.remove("hidden");
              
              const btnUnderstand = document.createElement("button");
              btnUnderstand.className = "px-4 py-2 bg-slate-800 hover:bg-slate-700 text-white text-sm font-medium rounded-lg transition-colors shadow-sm";
              btnUnderstand.innerText = "I Understand";
              btnUnderstand.onclick = hideLicense;
              
              licenseFooter.appendChild(btnUnderstand);
          }
      }

      function hideLicense() {
        licenseModal.classList.add("opacity-0");
        licenseModal.querySelector("div").classList.add("scale-95");
        setTimeout(() => {
          licenseModal.classList.add("hidden");
        }, 200);
      }
      
      function acceptLicense() {
          localStorage.setItem("license_accepted", "true");
          hideLicense();
          appContent.style.display = "flex"; // Show App
      }
      
      function declineLicense() {
          // Wipe DOM and Go Back
          document.documentElement.innerHTML = "";
          if (window.history.length > 1) {
              window.history.back();
          } else {
              window.close(); // Only works if opened by script
          }
      }
      
      // Initialize License Check
      function checkLicense() {
          const accepted = localStorage.getItem("license_accepted");
          if (accepted === "true") {
              appContent.style.display = "flex"; // Show content immediately
          } else {
              openLicenseModal(true); // Show forced modal
          }
      }
      
      // Event Listeners for Modal Closing (Only if NOT forced)
      document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && !licenseModal.classList.contains("hidden")) {
              // Only close if header close button is visible (implies not forced)
              if (!licenseCloseBtn.classList.contains("hidden")) {
                  hideLicense();
              }
          }
      });
      
      licenseModal.addEventListener("click", (e) => {
          if (e.target === licenseModal) {
               // Only close if header close button is visible (implies not forced)
               if (!licenseCloseBtn.classList.contains("hidden")) {
                  hideLicense();
              }
          }
      });
      
      // Trigger license check on load
      checkLicense();

      /* --- Search Logic --- */
      let searchIndex = [];

      function buildSearchIndex() {
        searchIndex = [];
        const fileElements = document.querySelectorAll(".file-item");
        fileElements.forEach((el) => {
          const name = el.querySelector("span").textContent.toLowerCase().trim();
          const parentContent = el.closest(".pl-4"); 
          
          // Get the code content from the hidden div
          const codeDiv = el.querySelector("div[id^='code-']");
          const code = codeDiv ? codeDiv.textContent.toLowerCase() : "";
          
          // Store storageID for click simulation
          const storageId = codeDiv ? codeDiv.id : "";

          searchIndex.push({ name, code, element: el, parent: parentContent, storageId });
        });
      }

      const searchInput = document.getElementById("search-input");
      
      // Helper to escape regex special characters
      function escapeRegExp(string) {
        return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      }

      searchInput.addEventListener("input", (e) => {
        const query = e.target.value.toLowerCase();
        
        // 1. Cleanup: Remove existing snippets and reset layout classes
        document.querySelectorAll('.search-snippet').forEach(el => el.remove());
        document.querySelectorAll('.file-item').forEach(el => {
            el.classList.remove('flex-wrap', 'pb-2');
            el.classList.remove('nav-selected'); // Remove selection style
            // Ensure default styling is maintained
        });
        
        // Reset selection index on search
        selectedFileIndex = -1;

        if (searchIndex.length === 0) buildSearchIndex();

        if (!query) {
             document.querySelectorAll('.file-item, .folder-container').forEach(el => el.classList.remove('hidden'));
             updateFolderState(); // Reset folder state check on clear
             return;
        }

        // Hide all initially
        document.querySelectorAll('.file-item').forEach(el => el.classList.add('hidden'));
        document.querySelectorAll('.folder-container').forEach(el => el.classList.add('hidden'));

        searchIndex.forEach(item => {
            const nameMatch = item.name.includes(query);
            const codeMatch = item.code.includes(query);

            if (nameMatch || codeMatch) {
                item.element.classList.remove('hidden');
                
                // Parent Folder Logic
                let parent = item.element.parentElement;
                while(parent && parent.id !== "file-list-container") {
                    parent.classList.remove('hidden'); 
                    if (parent.previousElementSibling) {
                        const folderContainer = parent.parentElement; 
                        if(folderContainer.classList.contains('folder-container')) {
                            folderContainer.classList.remove('hidden');
                        }
                        
                        if(parent.classList.contains('hidden')) {
                           const chevron = parent.previousElementSibling.querySelector('.chevron');
                           if(chevron && !chevron.classList.contains('rotated')) {
                               chevron.classList.add('rotated');
                           }
                           const fIcon = parent.previousElementSibling.querySelector('.folder-icon');
                           if(fIcon) fIcon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 19a2 2 0 01-2-2V7a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1M5 19h14a2 2 0 002-2v-5a2 2 0 00-2-2H9a2 2 0 00-2 2v5a2 2 0 01-2 2z"></path>`;
                        }
                    }
                    parent = parent.parentElement;
                }

                // Snippet Logic
                if (codeMatch) {
                    const originalCodeDiv = item.element.querySelector("div[id^='code-']");
                    if (originalCodeDiv) {
                        const originalCode = originalCodeDiv.textContent;
                        
                        // We find the first occurrence index
                        const matchIndex = item.code.indexOf(query);
                        
                        if (matchIndex !== -1) {
                            // Determine line number
                            const codePreMatch = item.code.substring(0, matchIndex);
                            const lineCount = (codePreMatch.match(/\n/g) || []).length;
                            
                            // Extract lines
                            const allLines = originalCode.split('\n');
                            const startLine = Math.max(0, lineCount - 2);
                            const endLine = Math.min(allLines.length, lineCount + 3);
                            
                            const snippetLines = allLines.slice(startLine, endLine);
                            
                            // Create Snippet Element
                            const snippetDiv = document.createElement('div');
                            // w-full ensures it breaks to new line in flex-wrap container
                            snippetDiv.className = 'search-snippet w-full mt-2 ml-4 sm:ml-7 p-2 bg-slate-100 border-l-4 border-blue-400 rounded-r text-xs font-mono text-slate-600 overflow-x-auto shadow-sm cursor-pointer hover:bg-slate-200 transition-colors';
                            
                            // Click event to open file from snippet
                            snippetDiv.onclick = (evt) => {
                                evt.stopPropagation(); // Prevent double firing if parent has click
                                // Extract raw URL from the parent's onClick attribute
                                const rawUrl = item.element.querySelector(".flex-1").getAttribute('onclick').match(/'([^']*)'\)$/)[1];
                                showCode(item.storageId, item.element.querySelector("span").textContent, rawUrl);
                            };
                            
                            let htmlContent = '';
                            const safeQuery = escapeRegExp(query);
                            const highlightRegex = new RegExp(`(${safeQuery})`, 'gi');

                            snippetLines.forEach((line, idx) => {
                                const currentLineNum = startLine + idx + 1;
                                
                                // Escape HTML special chars in the code line
                                let safeLine = line.replace(/&/g, "&amp;")
                                                   .replace(/</g, "&lt;")
                                                   .replace(/>/g, "&gt;")
                                                   .replace(/"/g, "&quot;")
                                                   .replace(/'/g, "&#039;");

                                // Highlight matches
                                safeLine = safeLine.replace(highlightRegex, '<mark class="bg-yellow-200 text-slate-900 font-bold rounded-sm px-0.5">$1</mark>');
                                
                                const isMatchLine = (currentLineNum - 1) === lineCount;
                                const lineClass = isMatchLine ? 'bg-blue-200/30 font-semibold' : '';

                                htmlContent += `<div class="whitespace-pre ${lineClass}"><span class="inline-block w-8 text-right mr-3 text-slate-400 select-none border-r border-slate-300 pr-1">${currentLineNum}</span>${safeLine}</div>`;
                            });
                            
                            snippetDiv.innerHTML = htmlContent;

                            // Adjust parent layout to accommodate full-width snippet
                            item.element.classList.add('flex-wrap', 'pb-2');
                            item.element.appendChild(snippetDiv);
                        }
                    }
                }
            }
        });
      });
      
      /* --- Keyboard Navigation Logic --- */
      let selectedFileIndex = -1;

      function handleKeyboardNav(e) {
        // Only if modal is hidden
        if (!modal.classList.contains("hidden")) return;

        const visibleFiles = Array.from(document.querySelectorAll('.file-item:not(.hidden)'));
        if (visibleFiles.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            // Move selection down, loop back to start if at end
            selectedFileIndex = (selectedFileIndex + 1) % visibleFiles.length;
            updateSelection(visibleFiles);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            // Move selection up, loop back to end if at start
            selectedFileIndex = (selectedFileIndex - 1 + visibleFiles.length) % visibleFiles.length;
            updateSelection(visibleFiles);
        } else if (e.key === 'Enter' && selectedFileIndex !== -1) {
            e.preventDefault();
            // Trigger click on the selected file item container (first child usually has the onclick)
            // The structure is .file-item > .flex-1 (this has onclick)
            const clickTarget = visibleFiles[selectedFileIndex].querySelector('.flex-1');
            if (clickTarget) clickTarget.click();
        }
      }

      function updateSelection(files) {
        // Remove 'nav-selected' class from all
        files.forEach(el => el.classList.remove('nav-selected'));
        
        // Add to current
        if (selectedFileIndex >= 0 && selectedFileIndex < files.length) {
            const selectedEl = files[selectedFileIndex];
            selectedEl.classList.add('nav-selected');
            
            // Scroll into view logic
            selectedEl.scrollIntoView({ block: 'nearest', behavior: 'smooth' });
        }
      }

      /* --- Share Functionality --- */
      function animateSuccess(btn, defaultIcon, successIcon) {
        defaultIcon.classList.add("hidden", "scale-0");
        successIcon.classList.remove("hidden", "scale-0");

        setTimeout(() => {
          successIcon.classList.add("hidden", "scale-0");
          defaultIcon.classList.remove("hidden", "scale-0");
        }, 2000);
      }

      document.addEventListener("DOMContentLoaded", () => {
         // Initial Folder State Check
         updateFolderState();

         const params = new URLSearchParams(window.location.search);
         const sharedFile = params.get('file');
         if (sharedFile) {
             const fileElements = document.querySelectorAll(".file-item");
             for (let el of fileElements) {
                 const name = el.querySelector("span").textContent.trim();
                 if (name === sharedFile) {
                     const onClickAttr = el.getAttribute('onclick');
                     const match = onClickAttr.match(/showCode\('([^']*)',\s*'([^']*)',\s*'([^']*)'\)/);
                     if (match) {
                         showCode(match[1], match[2], match[3]);
                     }
                     break;
                 }
             }
         }
      
        const shareBtn = document.getElementById("share-btn");
        const shareIconDefault = document.getElementById("share-icon-default");
        const shareIconSuccess = document.getElementById("share-icon-success");

        shareBtn.addEventListener("click", async () => {
          if (!currentFileUrl) return;

          const shareData = {
            title: "Check out this code",
            text: `View ${modalFilename.textContent} from the repository`,
            url: currentFileUrl,
          };

          if (navigator.share) {
            try {
              await navigator.share(shareData);
            } catch (err) {
              if (err.name !== "AbortError") {
                console.error("Share failed:", err.message);
              }
            }
          } else {
            navigator.clipboard.writeText(currentFileUrl).then(() => {
              animateSuccess(shareBtn, shareIconDefault, shareIconSuccess);
            });
          }
        });
        
        /* --- Copy Code Functionality --- */
        const copyCodeBtn = document.getElementById("copy-code-btn");
        const copyIconDefault = document.getElementById("copy-icon-default");
        const copyIconSuccess = document.getElementById("copy-icon-success");

        copyCodeBtn.addEventListener("click", () => {
            const codeText = modalCodeBlock.innerText;
            navigator.clipboard.writeText(codeText).then(() => {
                animateSuccess(copyCodeBtn, copyIconDefault, copyIconSuccess);
            }).catch(err => {
                console.error('Failed to copy code: ', err);
            });
        });

        document.addEventListener("keydown", (e) => {
          const searchInput = document.getElementById("search-input");
          if (e.key === "Escape" && !modal.classList.contains("hidden")) {
            hideCode();
            return;
          }
          if (
            e.key === "/" &&
            modal.classList.contains("hidden") &&
            !/^(INPUT|TEXTAREA|SELECT)$/i.test(document.activeElement.tagName)
          ) {
            e.preventDefault();
            searchInput.focus();
          }
        });
      });
    </script>
  </body>
</html>